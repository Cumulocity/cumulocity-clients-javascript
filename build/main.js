!function(){"use strict";var e=_.identity;window.c8yConfig={validation:{deviceId:{pattern:/^[^\s\/]*$/,message:e('Device ID must not contain spaces or slashes ("/").')},domain:{pattern:/^[a-z]+[a-z0-9_]*[a-z0-9]+\.{1}.+$/,message:e("Only lowercase letters, digits and underscore character allowed in the first part of the URI! It must start with a letter, underscore only allowed in the middle. Must be a valid URI.")},groupName:{maxlength:254},internationalPhoneNumber:{message:e("International phone number required, in the format +49 9 876 543 210.")},jsonPath:{pattern:/^(\$\.){0,1}[\$\.\[\]\w\@\<\>\-\*\(\)\d\'\?\s,:]*$/,message:e("Must be valid JSONPath expression.")},opcuaBrowsePath:{pattern:/^(opc.tcp|http|https):\/\/[^ "]+$/},password:{pattern:/^[a-zA-Z0-9`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]{8,32}$/,message:e("Password must have at least 8 characters and no more than 32 and can only contain letters, numbers and following symbols: `~!@#$%^&*()_|+-=?;:'\",.<>{}[]\\/")},phoneNumber:{pattern:/^$|^(\+|0{2})[\d\s\/-]{1,30}$/,message:e('Invalid phone number format. Only digits, spaces, slashes ("/") and dashes ("-") allowed.')},tennantId:{pattern:/^[a-z]+[a-z0-9_]*[a-z0-9]+$/,message:e("Only lowercase letters, digits and underscore character allowed! Must start with a letter, underscore only allowed in the middle, minimum 2 characters.")},user:{pattern:/^[^\\\/\s$:+]*$/,message:e('Username must not contain spaces nor slashes ("/", "\\") nor ("+"), (":"), ("$") signs.')}},deviceListMap:{},tracking:{},smartRules:{},administration:{statistics:{}},deviceDetailControl:{showControls:!1}}}(),function(){"use strict";function e(e){return e}!function(){try{angular.module("gettext")}catch(t){angular.module("gettext",[]).constant("gettext",e).constant("gettextCatalog",{getString:e})}}(),angular.module("c8y.core",["ngRoute","angularFileUpload","gettext"]).constant("c8yConfig",window.c8yConfig)}(),function(){"use strict";function e(e,t,n,r){function a(t,n){return e.put("/service/register/messaging",{provider:"openit","openit.baseUrl":"https://sms.openit.de/put.php","sms.senderAddress":"cumulocity","sms.senderName":"cumulocity","openit.username":t,"credentials.openit.password":n})}function i(){return r.detail({category:"messaging",key:"openit.username"})}function o(){return t.all([r.deleteOption({category:"messaging",key:"openit.username"}),r.deleteOption({category:"messaging",key:"credentials.openit.password"})]).then(function(e){return e})}return{updateSMSGatewayInfo:a,getSMSGatewayUsername:i,deleteSMSGatewayCredentials:o}}angular.module("c8y.core").factory("c8ySMSGateway",["$http","$q","c8yAlert","c8ySettings",e])}(),function(){"use strict";function e(e,t,n,r,a,i,o,u){function s(e){var n=e.id||e;return t.url(M+"/"+n)}function c(n){var r=t.url(M),a=t.timeOrderFilter(t.pageSizeNoTotalFilter(n)),i={params:a},o=t.cleanListCallback("alarms",c,a);return e.get(r,i).then(o)}function l(t){var n=s(t);return e.get(n)}function f(n){var r=t.url(M),a=L(n,j);return e.post(r,a,k)}function d(t){var n=s(t),r=L(t,B);return e.put(n,r,k)}function p(e){return e.id?d(e):f(e)}function m(e,t){function n(t){var n="--";return e.status!==$.ACKNOWLEDGED||_.isEmpty(t)||(n=_.last(t).user),t.forEach(function(e){var t=e.changes||[],r=!1;if(t.forEach(function(e){if(e.attribute===z&&e.newValue===$.ACKNOWLEDGED)return r=!0,!1}),r)return n=e.user||n,!1}),n}return t?n(t):a.list({source:e.id,pageSize:1e3}).then(n)}function g(e,t){function n(e){var t=e||[],n=t.length?t[t.length-1].creationTime:void 0;return t.forEach(function(e){var t=e.changes||[],r=!1;if(t.forEach(function(t){if(t.attribute===z&&t.newValue===$.ACKNOWLEDGED)return n=e.creationTime,r=!0,!1}),r)return!1}),n}return t?n(t):a.list({source:e.id,pageSize:1e3}).then(n)}function h(e,t){var n=v(e,t);return n.humanize?n.humanize():n.then(function(e){return e.humanize?e.humanize():""})}function v(e,t){function n(t){var n=t||[],r=e.creationTime,a=n.length?n[n.length-1].creationTime:void 0,i="";if(_.forEach(n,function(e){var t=e.changes||[],n=!1;if(t.forEach(function(t){if(t.attribute===z&&t.newValue===$.CLEARED)return a=e.creationTime,n=!0,!1}),n)return!1}),r&&a){var o=moment(r),u=moment(a);i=moment.duration(o.diff(u))}return i}return t?n(t):a.list({source:e.id,pageSize:1e3}).then(n)}function y(e){var t=(_.isObjectLike(e)?e.severity:e).toUpperCase();return q[t]}function T(e,n){var r=[U,e];return n.id&&r.push(n.id),t.url(r.join("/"))}function E(n){var r=t.timeOrderFilter(n),a=T("downtimeDuration",r),i={params:r};return e.get(a,i)}function S(e){var t=new n.Counter(c,"/alarms/*");if(e){var r=[n.defaultPropertyMaps.date,n.defaultPropertyMaps.source];if(e.type){var a=e.type;r.push([function(e){return a===e.type}])}delete e.type,t.filter(e,r)}return t}function A(e,t){return r.all(_.map(e,function(e,n){if(e)return t.status=n,c(t)})).then(I)}function b(e,t){return r.all(_.map(e,function(e){return t.source=e,c(t)})).then(I)}function C(e,t){return _.filter(e,{severity:t}).length}function I(e){return _.filter(e,function(e){return!_.isUndefined(e)})}function R(e){var t=_.memoize(e,function(e){return[e.id,e.status,e.count].join(":")});return function(e,n){return t(e,n)}}function w(e,t){var n;switch((e.status||"").toUpperCase()){case $.ACKNOWLEDGED:n=N;break;case $.CLEARED:n=D;break;case $.ACTIVE:n=O}return n&&n(e,t)}function N(e,t){var n=r.when(P.acknowledgedBy(e,t)),a=r.when(P.ackTime(e,t));return r.all([n,a]).then(function(e){return o.getString("ACKNOWLEDGED by: {{ackBy}} {{ackTimeFromNow}}",{ackBy:e[0],ackTimeFromNow:moment(e[1]).fromNow()})})}function D(e,t){return r.when(P.alarmDuration(e,t)).then(function(e){return o.getString("CLEARED: was active for {{alarmDuration}}",{alarmDuration:e})})}function O(e){return r.when(o.getString("ACTIVE: triggered {{alarmTimeFromNow}}",{alarmTimeFromNow:moment(e.time).fromNow()}))}var P=this,L=t.cleanFields,M="alarm/alarms",U=M+"/reports",k={headers:t.contentHeaders("alarm")},x={WARNING:i("WARNING"),MINOR:i("MINOR"),MAJOR:i("MAJOR"),CRITICAL:i("CRITICAL")},F=_.keys(x),$={ACTIVE:i("ACTIVE"),ACKNOWLEDGED:i("ACKNOWLEDGED"),CLEARED:i("CLEARED")},G=_.keys($),j=["id"],B=["id","self","creationTime","type","time","count","history","firstOccurence","firstOccurrenceTime"],q={},z="status";this.reservedKeys=["history","id","severity","self","source","creationTime","time","text","firstOccurrence","count","firstOccurrenceTime","status"],this.standardKeys={type:i("Type")},q[x.WARNING]="circle",q[x.MINOR]="exclamation-circle",q[x.MAJOR]="exclamation-circle",q[x.CRITICAL]="warning",q[$.CLEARED]="check-circle",q[$.ACKNOWLEDGED]="eye",q[$.ACTIVE]="bell",_.assign(this,{list:c,listByStatus:A,listByDevices:b,getSeverityCount:C,detail:l,update:d,create:f,save:p,acknowledgedBy:R(m),ackTime:R(g),alarmDuration:R(h),alarmDurationDiff:R(v),severity:x,severityList:F,status:$,statusList:G,statusText:R(w),icon:y,reports:{downtimeDuration:E},createCounter:S}),_.assign(this,u),_.bindAll(this,_.keys(u))}angular.module("c8y.core").service("c8yAlarms",["$http","c8yBase","c8yCounter","$q","c8yAudits","gettext","gettextCatalog","KeysMixin",e])}(),function(){"use strict";function e(e,t,n,r,a,i,o,u,s,c,l,f,d){function p(e){var t=_.cloneDeep(e);return delete t.type,t}function m(e){return e.replace(/\s+/g,"_")}function g(t,n){return c.current().then(function(r){var a=r.tenant,i=s.pageSizeFilter(n),o={params:i,cache:!0},u=s.url(t)+"/"+a,c=s.cleanListCallback("applications",angular.bind(Re,g,t),i);return e.get(u,o).then(c).then(ye)})}function h(t,n){return c.current().then(function(r){t=t||r;var a=s.pageSizeFilter(n),i={params:_.defaults(a,{noPaging:!0,dropOverwrittenApps:!0}),cache:!0},o=s.url(be+"applicationsByUser/"+encodeURIComponent(t.id)),u=s.cleanListCallback("applications",angular.bind(Re,h,t),a);return e.get(o,i).then(u).then(ye)})}function v(e){return e=_.cloneDeep(e),void 0===e.type?e:(e.type=y(e)?"REPOSITORY":e.type,e)}function y(e){return"HOSTED"===e.type&&e.resourcesUrl&&"/"!==e.resourcesUrl.charAt(0)}function T(e){return g(be+"applicationsByOwner",e)}function E(e){return g(be+"applicationsByTenant",e)}function S(){var t=s.url(be+"plugins"),n={params:{pageSize:De}};return e.get(t,n).then(function(e){return _.uniqBy(e.data.plugins,"id")})}function A(){return E().then(function(e){e=_.uniqBy(e,"id");var t=[];return _.forEach(e,function(e){Ee(e)&&t.push(b(e))}),n.all(t).then(_.flattenDeep).then(_.partialRight(_.uniqBy,function(e){return e.id}))})}function b(t){var n=s.url(Ce+"/"+t.contextPath+"/manifest"),r={params:s.pageSizeNoTotalFilter()};return e.get(n,r).then(function(e){return _.map(e.data.imports,I)})}function C(t){var n=C._cache,r=t.id||t,a=s.url(Ce+"/"+r+"/binaries/plugins"),o={params:s.pageSizeNoTotalFilter()},u=function(){delete n[r]},c=function(){return e.get(a,o).then(s.getResData).finally(u)};return n[r]||(n[r]=i(_.noop,2e3).then(c)),n[r]}function I(e){return{id:e.id,contextPath:e.rootContextPath,directoryName:e.directoryName,manifest:e}}function R(e){var t=e.id||e;return s.url(Ce+"/"+t)}function w(t){var n=R(t);return e.get(n)}function N(t){var r=R(t),a=_.isObjectLike(t)?t:{id:t},i=[],o=fe(a).then(function(e){return!e.config||!e.config.id||l.remove(e.config)});return i.push(o),i.push(e.delete(r)),n.all(i)}function D(t,n){var a=R(t),i=p(t),o=_.defaults(n||{},Ie);return e.put(a,i,o).finally(function(){r.localStorage.setItem("refresh",t.contextPath)})}function O(t,n){var r=s.url(Ce),a=_.defaults(n||{},Ie);return e.post(r,t,a)}function P(e){return e=_.cloneDeep(e),"HOSTED"===e.type&&(e.resourcesUrl="/"),"REPOSITORY"===e.type&&(e.type="HOSTED"),e}function L(e,t){return w(e).then(function(e){var n=e.data;return n.manifest=t,n}).then(D)}function M(e,t){return e.id?D(e,t):O(e,t)}function U(e,t,r,a){var i=_.cloneDeep(e);return r=r||0,a=a||n.defer(),i.name=0===r?e.name:[e.name,r].join("-"),i.key=0===r?e.key:[e.key,r].join("-"),i.contextPath=0===r?e.contextPath:[e.contextPath,r].join("-"),M(i,{silentError:!0}).then(function(e){a.resolve(s.getResData(e))},function(n){if(409===n.status&&r<10)U(e,t,r+1,a);else{var i=n&&n.data&&(n.data.message||n.data.details&&n.data.details.exceptionMessage),o=i&&Ae.getTranslatedServerMessage(i)||d('Could not create application due to an error! Click "More" for details.');a.reject({errorMessage:o,errorDetails:n})}}),a.promise}function k(t,n){var r=R(t)+"/clone";return e.post(r).then(s.getResData).then(function(e){return _.isObjectLike(n)?(_.assign(e,n),U(e).then(s.getResData)):e})}function x(t,n){var r=R(t)+"/binaries";n=s.pageSizeNoTotalFilter(n);var a={params:n};return e.get(r,a).then(s.getResData)}function F(e,t){var n=R(e)+"/binaries";return f.upload({url:n,method:"POST",headers:{Content:"multipart/form-data",Accept:"application/json"},file:t,fileName:m(t.name)})}function $(t,n){var r=n.id||n,a=[R(t),"binaries",r].join("/");return e.delete(a)}function G(e,t){return M({id:e.id,activeVersionId:t.id})}function j(e,t){var n=B(t),r=R(e)+"/binaries/plugins/"+n,a=f.upload({url:r,method:"POST",headers:{Content:"multipart/form-data",Accept:"application/json"},file:t}),i=a.then(_.partial(q,e));return i.progress=a.progress,i}function B(e){var t=e.name.split(".");return t.pop(),t.join(".")}function q(e){var t=w(e).then(s.getResData),r=t.then(C),a=t.then(W),i=t.then(J);return n.all([t,r,a,i]).then(function(t){var r=t[0],a=z(t[1]),i=t[2],o=t[3];return n.all([Q(r,a,i),X(r,a,o)]).then(function(t){var n=t[0],r=t[1];return re(e,[{path:"cumulocity.json",file:new Blob([JSON.stringify(n)],{type:"application/json"})},{path:"index.html",file:new Blob([r],{type:"text/html"})}])})})}function z(e){var t=[];return e=_.sortBy(e,function(e){return e&&e.pluginPackage&&-e.pluginPackage.priority||0}),_.forEach(e,function(n){V(n,t,e)}),t}function V(e,t,n){if(!H(t,e&&e.pluginPackage&&e.pluginPackage.contextPath)){var r=e&&e.pluginPackage&&e.pluginPackage.imports||[];_.forEach(r,function(e){var r=H(n,e);r?V(r,t,n):o.error("Plugin with context path "+e+" is missing.")}),t.push(e)}}function H(e,t){var n=K(t);return _.find(e,function(e){return e&&e.pluginPackage&&e.pluginPackage.contextPath===n})}function K(e){var t=e;return Y(t)&&(t=t.replace(/\//g,"_")),t}function Y(e){return/^core\//.test(e)||/^administration\//.test(e)||/^devicemanagement\//.test(e)||/^cockpit\//.test(e)||/^platformadmin\//.test(e)||/^fieldbus4\//.test(e)||/^fieldbus3\//.test(e)||/^fieldbus2\//.test(e)||/^fieldbus\//.test(e)||/^demoboard\//.test(e)||/^vendme_plugins\//.test(e)}function W(t){var n=Z(t)+"/cumulocity.json";return e.get(n).then(s.getResData)}function J(t){var n=Z(t)+"/index.html";return e.get(n).then(s.getResData)}function Z(e){return s.url("apps/"+e.contextPath)}function Q(e,t,n){var r=_.cloneDeep(n);return r.imports.length=0,_.forEach(t,function(e){r.imports.push(e.pluginName)}),r}function X(e,t,n){return n=ee(e,t,n),n=te(e,t,n),n=ne(e,t,n)}function ee(e,t,n){var r=_(t).map(function(e){var t=e.pluginPackage&&e.pluginPackage.css||[];return t=t.length?t:e.pluginPackage&&e.pluginPackage.less||[],!!t.length&&e.pluginName+"/style.css"}).filter(_.identity).value(),a=_.flattenDeep(["<!--MODULES_CSS-->",_.map(r.slice(0,1),function(e){return'<link rel="stylesheet" href="'+e+'"></link>'}),"<!--/MODULES_CSS-->"]).join("\n"),i=_.flattenDeep(["<!--MODULES_CSS_DEFER-->","<script>",["[",'"'+r.slice(1).join('", "')+'"',"].forEach(function(f){loadCSS(f)})"].join(""),"</script>","<!--/MODULES_CSS_DEFER-->"]).join("\n");return n=n.replace(new RegExp("<!--MODULES_CSS-->(.|\n|\r)*<!--\\/MODULES_CSS-->","gm"),a),n.replace(new RegExp("<!--MODULES_CSS_DEFER-->(.|\n|\r)*<!--\\/MODULES_CSS_DEFER-->","gm"),i)}function te(e,t,n){var r=_.flattenDeep(["<!--MODULES_JS-->",_(t).map(function(e){return!!(e.pluginPackage&&e.pluginPackage.js||[]).length&&e.pluginName+"/main.js"}).filter(_.identity).map(function(e){return'<script defer src="'+e+'"></script>'}).value(),"<!--/MODULES_JS-->"]).join("\n");return n.replace(new RegExp("<!--MODULES_JS-->(.|\n|\r)*<!--\\/MODULES_JS-->","gm"),r)}function ne(e,t,n){var r=['C8Y_NG_MODULES=["',_.uniq(_.flattenDeep(_.map(t,function(e){return e.pluginPackage&&e.pluginPackage.ngModules||[]}))).join('","'),'"];'].join("");return n.replace(new RegExp("C8Y_NG_MODULES=\\[(.|\n|\r)*?\\];","gm"),r)}function re(t,n){var r=R(t)+"/binaries/files",a=new FormData;return _.forEach(n,function(e){a.append(e.path,new File([e.file],e.path))}),e.post(r,a,{transformRequest:_.identity,headers:{"Content-Type":void 0}})}function ae(t,n){var r=n.pluginName||n,a=R(t)+"/binaries/plugins/"+r;return e.delete(a).then(_.partial(q,t))}function ie(e){return W(e).then(function(e){return e._webpaas},function(){return!1})}function oe(e){var n=t.port();return n=80===n||443===n?"":":"+n,t.protocol()+"://"+t.host()+n+"/apps/"+(e.public?"public/":"")+e.contextPath}function ue(){var e=r.location.pathname.match(/\/apps\/(public\/){0,1}(.+?)(\/|\?|\#|$)/);return e&&e[2]}function se(){var e=r.location.pathname.match(/\/apps\/(public\/([^\/]+)|([^\/]+))/);return e&&-1!==e[1].indexOf("public")}function ce(){function e(e){var r="MARKET"===e.availability;return e.contextPath===t&&(!n||r)}var t=ue(),n=!!se();return h(null,{dropOverwrittenApps:!1}).then(function(t){return _.find(t,e)})}function le(e){return l.list({type:"c8y_SmartAppApplication"}).then(function(t){var n=null;return t.forEach(function(t){if(t.appId===e.id)return n=t,!1}),n})}function fe(e){var t;return(e?n.when(e):ce()).then(function(e){return t=e,e}).then(le).then(function(e){return t.config=e,t})}function de(e){r.localStorage.getItem("refresh")===ue()&&(r.localStorage.setItem("refresh",void 0),e||r.location.reload())}function pe(e){return Ee(e)?oe(e):e.externalUrl}function me(e){var t=_.isString(e)?e:e.type;return e.manifest&&(t="SMARTAPP"),we[t]}function ge(e){var t=_.isString(e)?e:e.type;return Ne[t]}function he(){a(function(){de()},1e3,0,!1)}function ve(e){return _(e).uniq("id").filter(function(e){var t=e.manifest,n=!1,r=["HOSTED","EXTERNAL"];return t&&(n=t.noAppSwitcher),!n&&_.includes(r,e.type)}).value()}function ye(e){var t=_.reject(e,function(e){return"management"===e.name&&"management"===e.owner.tenant.id});return _.assign(t,_.pick(e,_.filter(_.keys(e),isNaN))),t}function _e(){return h().then(ve).then(function(e){return n.when(e)})}function Te(e){return e&&"devicemanagement"===e.toLowerCase()?"Device management":e||"Cumulocity"}function Ee(e){return"HOSTED"===e.type||"REPOSITORY"===e.type}function Se(){function t(e){return{url:e,noAppKey:!0}}function r(n){return e(t([s.url(Ce),n.data.application.id].join("/")))}return Se._cache?Se._cache:function(){return e(t([s.url(Ce),(se()?"public/":"")+ue(),"manifest"].join("/")))}().then(r).then(s.getResData).then(function(e){return Se._cache=n.when(e),Se._cache})}var Ae,be="application/",Ce=be+"applications",Ie={headers:s.contentHeaders("application",!0)},Re=this,we={HOSTED:"cloud",EXTERNAL:"external-link-square",SMARTAPP:"puzzle-piece"},Ne={HOSTED:d("Hosted application"),REPOSITORY:d("Repository"),EXTERNAL:d("External application")},De=1e3;try{Ae=u.get("c8yLocales")}catch(e){Ae={getTranslatedServerMessage:_.identity}}return d("Administration"),d("Cockpit"),d("Device management"),d("Fieldbus4"),C._cache={},s.getFlag("test")&&(Se._cache=n.when({name:"app",manifest:{}})),{list:E,listByUser:h,listByTenant:E,listByOwner:T,listPlugins:S,listPluginsByTenant:A,listPluginsByApplication:b,listPluginsByPaasApp:C,listByVisibleLinks:_e,detail:w,update:D,create:O,remove:N,save:M,trySave:U,clone:k,getHref:pe,icon:me,typeLabel:ge,getCurrent:ce,getConfig:fe,pollRefreshMessages:he,getCurrentContextPath:ue,updateManifest:L,listArchives:x,uploadArchive:F,deleteArchive:$,setActiveArchive:G,addPaasAppPlugin:j,removePaasAppPlugin:ae,uploadPaasAppFiles:re,getPaasAppManifest:W,refreshPaasApp:q,isPaasApp:ie,convertType:v,revertType:P,parseAppName:Te,currentAppCached:Se}}angular.module("c8y.core").factory("c8yApplication",["$http","$location","$q","$window","$interval","$timeout","$log","$injector","c8yBase","c8yUser","c8yInventory","$upload","gettext",e])}(),function(){"use strict";function e(e,t,n,r){function a(e){var n=e.id||e;return t.url(c+"/"+n)}function i(n){var r=t.url(c),a=t.pageSizeNoTotalFilter(n);if(a.revert){var o=t.timeOrderFilter({});a.dateFrom=a.dateFrom||o.dateFrom,a.dateTo=a.dateTo||o.dateTo}var u={params:a},s=t.cleanListCallback("auditRecords",i,a);return e.get(r,u).then(s)}function o(t){var n=a(t);return e.get(n)}function u(n){var r=t.url(c),a=s(n,m);return e.post(r,a,l)}var s=t.cleanFields,c="audit/auditRecords",l={headers:t.contentHeaders("auditRecord")},f={WARNING:"WARNING",MINOR:"MINOR",MAJOR:"MAJOR",CRITICAL:"CRITICAL"},d=_.keys(f),p=["id","self","creationTime"],m=p;this.types={User:r("User"),Group:r("Group"),Alarm:r("Alarm"),Operation:r("Operation"),SmartRule:r("Smart Rule"),CepModule:r("Event processing"),Tenant:r("Tenant")},this.reservedKeys=p,this.standardKeys={},_.assign(this,{list:i,detail:o,create:u,severity:f,severityList:d}),_.assign(this,n),_.bindAll(this,_.keys(n))}e.$inject=["$http","c8yBase","KeysMixin","gettext"],angular.module("c8y.core").service("c8yAudits",e)}(),function(){"use strict";function e(e){e.interceptors.push("c8yAuth")}function t(e,t,n,r,a,i,o,u){function s(e){var t=decodeURIComponent(escape(atob(e))),n=t.match(/(([^\/]*)\/)?([^\/:]+):(.+)/);return{tenant:n[2],user:n[3],password:n[4]}}function c(e,t,n){var r=(n?n+"/":"")+e+":"+t;return btoa(unescape(encodeURIComponent(r)))}function l(e){var t=s(Z);return A(c(t.user,e,t.tenant))}function f(e){return e.headers||(e.headers={}),_.defaults(e.headers,$()),e}function d(e){return!(!e.headers||!e.headers.Authorization)}function p(e){return!Z||!e.noAppKey}function m(e){var t=e.url,n=v(t);if(!n||ce.test(t)||le.test(t))return e;var a,i=n&&!d(e)&&p(e);a=i?me.initializing.done?ue.promise:r.all([me.initializing,ue.promise]):se.promise;var o=n?_.partial(f,e):function(){return e};return Z&&window.c8y_testing?o():a.then(o)}function g(){D(),_.isFunction(u.logout)&&u.logout()}function h(e){return e.headers("tfatokenexpired")&&de.hasAuth&&g(),r.reject(e)}function v(e){var t=u.baseUrl||"/";if(!e)return!0;fe.href=e||"";var n=fe.host;return t.length>1&&e.indexOf(t)>-1||!n||n===y()}function y(){var t=e.host(),n=e.port();return 80===n||443===n?t:[t,n].join(":")}function T(e){Q=e;var t=te.url("user/currentUser?auth");return window.c8y_testing?r.when(A(e)):ee({url:t,silentError:!0,headers:{Authorization:e?"Basic "+e:void 0,UseXBasic:!0,Accept:"application/vnd.com.nsn.cumulocity.user+json;"}}).then(te.getResData).then(_.partial(E,e)).then(A)}function E(e,t){var n=s(e);return c(n.user,n.password,S(t))}function S(e){return e.self.match(/\/user\/(\w+)\//)[1]}function A(e){Z=u.token=e,U(u.appKey);var t=!pe,n=t?C():r.when();return L(),n.then(I)}function b(){delete u.token,ue.promise.$$state.status&&(ue=r.defer()),R({hasAuth:!1}),k()}function C(){return ne.currentAppCached().then(function(e){u.appConfig=_.defaults(u.appConfig||{},e),U(e.key)})}function I(){ue.resolve(),R({hasAuth:!0})}function R(e){_.isEqual(e,de)||(de=e,t.$emit("authStateChange",de))}function w(){X=void 0,delete u.TFAToken,x()}function N(e){X=u.TFAToken=e,O(X,!0,ae)}function D(){w(),b()}function O(e,t,n){i[(t?"local":"session")+"Storage"].setItem(n,e)}function P(e){return i.localStorage.getItem(e)||i.sessionStorage.getItem(e)}function L(){i.sessionStorage&&i.sessionStorage.setItem(re,Z),i.localStorage.getItem(re)&&i.localStorage.setItem(re,Z)}function M(e){O(Z,e,re)}function U(e){pe=u.appKey=e}function k(){i.localStorage.removeItem(re),i.sessionStorage.removeItem(re)}function x(){i.localStorage.removeItem(ae)}function F(){var e=u.token||P(re),t=u.TFAToken||P(ae);if(U(u.appKey),t&&N(t),e){var n=T(e);return n.catch(k),n}return r.when()}function $(){var e={Authorization:Z?"Basic "+Z:void 0,tfatoken:X,UseXBasic:!0};return e[ie]=pe,e}function G(e){return{Authorization:"Basic "+c(oe.u,oe.p,e)}}function j(e){var t={silentError:!0,url:te.url("user/passwordReset"),method:"POST",data:{email:e.email},headers:G(e.tenant)};return ee(t)}function B(t){function n(t){return J=void 0,e.url(e.path()),t}var r=t.tenant,a=t.newPassword,i=(t.passwordStrength||"").toUpperCase(),o={silentError:!0,url:te.url("user/passwordReset"),method:"PUT",data:{token:J,newPassword:a,passwordStrength:i},headers:G(r)};return ee(o).then(n)}function q(e){J=e}function z(e){x();var t={url:te.url("user/pin"),data:{pin:e},method:"POST",silentError:!0,headers:{Authorization:"Basic "+Q,"Content-Type":"application/vnd.com.nsn.cumulocity.user+json;"}};return ee(t).then(V)}function V(e){var t=e.headers("tfatoken");t&&N(t),T(Q)}function H(){return Z&&s(Z).password}function K(e){return W([{path:"system/options/password/enforce.strength",prop:"systemLevel",checkFn:function(e){return"true"===(e.data||{}).value}},{path:"security-options/password/strength.validity",prop:"tenantLevel",checkFn:function(e){return"true"===(e.data||{}).value}}],e).then(function(e){return e.systemLevel||e.tenantLevel})}function Y(e){return W([{path:"system/options/password/green.min-length",prop:"minGreenLength",checkFn:function(e){return _.parseInt((e.data||{}).value)}}],e).then(function(e){return e.minGreenLength})}function W(e,t){var n=_.map(e,function(e){var n={};return n[e.prop]=!1,ee({url:te.url("tenant/"+e.path),headers:G(t),silentError:!0}).then(function(t){var n={};return n[e.prop]=e.checkFn(t),n}).catch(function(){return n})});return r.all(n).then(function(e){return _.reduce(e,function(e,t){return _.assign(e,t)},{})})}var J,Z,Q,X,ee,te,ne,re="_tcy8",ae="TFAToken",ie="X-Cumulocity-Application-Key",oe={u:"passwordreset",p:"p455w0rdr3537"},ue=r.defer(),se=r.defer(),ce=/\.html$/,le=/\.json$/,fe=document.createElement("a"),de={hasAuth:!1},pe=u.appKey;se.resolve(),q(u.passResetToken||function(){return e.search?e.search():{}}().token);var me={decodeToken:s,encodeToken:c,logout:g,updatePassword:l,request:m,responseError:h,setAuthToken:T,clearTokens:D,setTFAToken:N,clearTFAToken:w,saveAuthToken:M,checkSavedTokens:F,setAppKey:U,headers:$,resetPasword:j,changePasswordWithResetToken:B,setRecoverPassToken:q,verifyTFACode:z,getPassword:H,mustEnforcePasswordStrength:K,getPasswordMinGreenLength:Y};return me.initializing=r.when().then(function(){return ee=n.get("$http"),te=n.get("c8yBase"),ne=n.get("c8yApplication"),window.c8y_testing?(A(u.token),{testing:!0}):J?(e.search("token",J),D(),{recoverPassword:!0}):u.noSavedTokens?{noSavedTokens:!0}:F()}).finally(function(){me.initializing.done=!0}),window.c8y_testing&&(i.localStorage||(i.localStorage=window.localStorage),i.sessionStorage||(i.sessionStorage=window.sessionStorage)),me}t.$inject=["$location","$rootScope","$injector","$q","$log","$window","$timeout","info"],angular.module("c8y.core").factory("c8yAuth",t).config(["$httpProvider",e])}(),function(){"use strict";function e(e){return((window.C8Y_APP||{}).core_path||"/apps/core/")+e}function t(e){return((window.C8Y_APP||{}).data_path||(window.C8Y_PAAS?"/apps/core/c8ydata/":"/apps/c8ydata/"))+e}function n(n,r,a,i,o,u){function s(e){return B+e+"+json"}function c(e,t){return{"Content-Type":s(e),Accept:t?s(_.isString(t)?t:e):void 0}}function l(e,t){return R(e,t)}function f(e){return j()+e}function d(e){return _.assign({pageSize:q},e)}function p(e){return _.assign({withTotalPages:!0,pageSize:q},e)}function m(e){return _.assign({dateFrom:"1970-01-01",dateTo:moment().add(1,"day").format(z)},e)}function g(e){return _.assign({dateFrom:moment().subtract(1,"week").format(z),dateTo:moment().add(1,"day").format(z)},e)}function h(e){return _.assign({dateFrom:moment().startOf("month").format(z)},e)}function v(e,t){var n=moment().subtract(t||0,"months");return _.assign({dateFrom:n.startOf("month").format(z),dateTo:n.endOf("month").format(z)},e)}function y(e){return _.assign({dateFrom:moment().subtract(1,"day").format(z),dateTo:moment().add(1,"day").format(z)},e)}function T(e){var t=function(n){var r=n.paging,a=["refresh","next"];_.forEach(a,function(e){var n="__"+e;!r[n]&&r[e]&&(r[n]=r[e],r[e]=function(){return r[n]().then(t)})});var i=n.filter(e);return i.statistics=n.statistics,i.paging=n.paging,i};return t}function E(e,t){var n={};return t&&t.split("?")[1].split("&").forEach(function(e){var t=e.split("=");n[t[0]]=decodeURIComponent(t[1])}),n[e]}function S(e,t){var n=e.statistics,r=1===t?"next":"prev",a=e[r],i={currentPage:n.currentPage,pageSize:n.pageSize,startkey:E("startkey",a),startkey_docid:E("startkey_docid",a)},o=E("currentPage",a);return i.currentPage=parseInt(o),i}function A(e,t){var n=e.statistics||{},r={currentPage:t?n.currentPage:1,pageSize:t?n.pageSize:n.pageSize*n.currentPage,startkey:null,startkey_docid:null};return _.isUndefined(e.totalPages)||(r.pageSize=n.pageSize),r}function b(e,t,n,r,a){var i=e.statistics,o=!_.isUndefined(e.prev),u=!_.isUndefined(e.next),s={};if(o){var c=_.assign(_.cloneDeep(n),S(e,-1));s.prev=angular.bind({},t,c)}if(u){var l=_.assign(_.cloneDeep(n),S(e,1));s.next=angular.bind({},t,l),_.isUndefined(i.totalPages)||(s.more=(i.totalPages-i.currentPage)*i.pageSize)}var f=_.assign(_.cloneDeep(n),A(e,a)),d=angular.bind({},t,f);s.statistics=i,s.blind=r,s.refresh=function(){return d().then(function(e){return a&&(e.paging=b(e,t,n,r,a)),e})};var p=function(e){var r=_.assign({},n,{pageSize:i.pageSize,currentPage:e});return t(r)};return s.changePage=function(e){return p(e).then(function(e){return e.paging=b(e,t,n,r,!0),e})},s}function C(e,t,n){return function(r){var a=r.data||{},i=a[e]||[];return i.statistics=a.statistics,n.withTotalPages||i.length!==parseInt(n.pageSize,10)||(a.statistics.totalPages=i.statistics.totalPages=+1/0),i.paging=b(a,t,n,!n.withTotalPages),i}}function I(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)}function R(e,t){return _.omit(e,t)}function w(e,t,n){var r=e&&e[t],a=r&&r[n],i=a&&a.$pristine,o=a&&a.$invalid;return!1===i&&!0===o}function N(e){return e.$dirty&&e.$invalid}function D(e,t){var n=[];return e&&e.$error&&_.forEach(e.$error,function(r,a){r&&!_.isUndefined(t[a])&&(_.isObjectLike(t[a])&&t[a][e.$name]?n.push(t[a][e.$name]):n.push(t[a]))}),_.map(n,function(e){return o.getString(e)}).join(" ")}function O(e,t){return t.pageSize=1,t.withTotalPages=!0,e(t).then(function(e){return e.statistics.totalPages})}function P(e){return e||(e=""),String(e).replace(/c8y_/,"").replace(/([A-Z])/g," $1").replace(/^\s*/,"").replace(/\s*$/,"")}function L(e){return e&&e.data||e}function M(e){var t={},n=0;return t.values=_.constant(_.map(e,function(e){var r={};return _.isObjectLike(e)?_.defaults(r,e,{name:e.name,value:e.name,label:e.name}):_.defaults(r,{name:e,value:e,label:e}),_.assign(r,{ordinal:n++}),t[r.name]=r,r})),t}function U(e,t){if(t=t||"id",!_.isObjectLike(e))throw new Error("mo is not an object");return _.isUndefined(e[t])&&(e[t]=String(Math.random()).substr(2)),e}function k(e){var t;if(_.isObjectLike(e)&&(t=e.id),(_.isNumber(e)||_.isString(e)&&e.match(/^\d+$/))&&(t=String(e)),!t)throw new Error("id cannot be found");return t}function x(e){try{return _.forEach(e,function(e){angular.module(e)}),!0}catch(e){return!1}}function F(e){return i[e]}function $(e){var t=(i.appConfig||{}).manifest,n=window.C8Y_APP&&window.C8Y_APP.C8Y_INSTANCE_OPTIONS,r=window.C8Y_INSTANCE_OPTIONS;return _.merge({},t,n,r)[e]}function G(e){return a.has(e)?a.get(e):void 0}var j=function(){return i.baseUrl||"/"},B="application/vnd.com.nsn.cumulocity.",q=i.pageSize||100,z="YYYY-MM-DD",V={url:f,deleteProperties:l,mimeType:s,contentHeaders:c,PAGESIZE:q,pageSizeFilter:p,pageSizeNoTotalFilter:d,timeOrderFilter:m,lastWeekFilter:g,todayFilter:y,fromThisMonthStartFilter:h,monthFilter:v,createListFilter:T,cleanListCallback:C,removeFromList:I,cleanFields:R,dateFormat:z,dateFullFormat:"YYYY-MM-DDTHH:mm:ssZ",invalid:w,invalidFormOrField:N,validationHints:D,getCount:O,humanizeFragment:P,getResData:L,createEnum:M,createLocalId:U,getId:k,checkIfModulesExist:x,coreFilePath:e,dataFilePath:t,getFlag:F,getRuntimeOption:F,appOption:$,getPluginService:G};return _.mixin(V,u(r)),V}n.$inject=["$window","$q","$injector","info","gettextCatalog","latestMixinFactory"];var r=window.c8y=window.c8y||{};r.coreFilePath=e,r.dataFilePath=t,angular.module("c8y.core").factory("c8yBase",n)}(),function(){"use strict";function e(e,t,n,r,a,i,o,u,s,c){function l(){s.getSystemOptionValue(B,j).then(function(e){V.BYTES_SIZE_LIMIT=j=e})}function f(e,t){t&&t.hasAuth&&l()}function d(e){var t=i.url($),r=i.pageSizeFilter(e),a={params:r},o=i.cleanListCallback("managedObjects",d,r,!0);return n.get(t,a).then(o)}function p(e,t){var n={name:e.name,type:e.type},r=_.assign(n,t);return c.upload(e,{url:i.url($),headers:i.contentHeaders("managedObject","managedObject"),data:{object:r}})}function m(e,t){var n=T(e);return c.download(e,n,t).then(function(t){var n=t.getResponseHeader("Content-Type"),r=t.getResponseHeader("Content-Disposition"),a=g(e)?h(e,n):new Blob([t.response],{type:n});saveAs(a,c.getFilenameFromContentDisposition(r))})}function g(e){return e&&e.data}function h(e,t,n){for(var r=t||"",i=n||512,o=a.atob(e.data),u=[],s=0;s<o.length;s+=i){for(var c=o.slice(s,s+i),l=new Array(c.length),f=0;f<c.length;f++)l[f]=c.charCodeAt(f);var d=new Uint8Array(l);u.push(d)}return new Blob(u,{type:r})}function v(t){var n=T(t);return c.download(t,n).then(function(e){var n=e.getResponseHeader("Content-Type"),r=c.arrayBufferToBase64(e.response);return g(t)?M(t):"data:"+n+";base64,"+r}).catch(function(){return M(t)||e.reject()})}function y(e){var t=T(e),r={headers:u.headers(),responseType:"text",transformResponse:function(e){return e}};return n.get(t,r)}function T(e){var t=e.id||e;return i.url($+"/"+t)}function E(e){return e&&e.self&&e.self.replace(i.url(G),i.url($))}function S(e){var t=T(e);return n.delete(t)}function A(e){var t=["file","o"],n=b(e);return n&&t.splice(1,0,n),t.join("-")}function b(e){var t="";return _.forEach(z,function(n,r){var a=q.exec(e.name)[1];if(_.forEach(n.exts,function(e){if(e===_.lowerCase(a))return t=r,!1}),!t){var i=C(e);_.forEach(n.mimes,function(e){if(e===i)return t=r,!1})}}),t}function C(e){var t=e.contentType;return t||_.isUndefined(e._attachments)||(t=e._attachments[_.keys(e._attachments)[0]].content_type),t}function I(e){return c.size(e)}
function R(e){return"image"===b(e)}function w(e){return e&&e.size<=j}function N(e){return e.id?O(e):D(e)}function D(e){var t=_.assign(e,{c8y_IsBinary:!0});return o.createConfirm(t)}function O(e){return o.update(e)}function P(e,t){return o.detail(e,t)}function L(e){return o.remove(e)}function M(e){var t=_.get(e,"type")||_.get(e,"dataType"),n=_.get(e,"data"),r="";if(t&&n){try{a.atob(n)}catch(e){n=a.btoa(n)}r="data:"+t+";base64,"+n}return r}function U(t){var n=new FileReader,r=e.defer();return n.addEventListener("load",function(){r.resolve(n.result)},!1),n.addEventListener("error",function(e){r.reject(e)}),t&&n.readAsDataURL(t),r.promise}function k(e){return e&&e.data?a.atob(e.data):""}function x(e){var t=new RegExp("\\/inventory\\/binaries\\/(\\d+)|\\/inventory\\/managedObjects\\/(\\d+)"),n=e.match(t);return n&&(n[1]||n[2])}function F(e){return a.atob(_.last(e.split(",")))}var $="inventory/binaries",G="inventory/managedObjects",j=52428800,B={category:"files",key:"max.size"},q=/(?:\.([^.]+))?$/,z={archive:{mimes:[],exts:["7z","apk","cab","gz","iso","jar","rar","tar","zip"]},audio:{mimes:[],exts:["3gp","aiff","aac","amr","m4a","m4p","mp3","oga","ogg","raw","wav","wma"]},code:{mimes:[],exts:["aspx","exe","htm","html","jad","js","json","jsp","php","xml"]},excel:{mimes:[],exts:["xls","xlsx"]},image:{mimes:[],exts:["bmp","gif","jpeg","jpg","png","tiff","svg"]},pdf:{mimes:[],exts:["pdf"]},powerpoint:{mimes:[],exts:["ppt","pptx"]},text:{mimes:[],exts:["txt"]},video:{mimes:[],exts:["3gp","asf","avi","flv","mov","mp4","ogv","qt","rm","rmvb","wmv"]},word:{mimes:[],exts:["doc","docx"]}};window.c8y_testing||(u.initializing.then(l),r.$on("authStateChange",f));var V=_.assign(_.cloneDeep(o),{BYTES_SIZE_LIMIT:j,list:d,upload:p,downloadAndSaveAs:m,downloadAsDataUri:v,downloadAsText:y,getDownloadUrl:E,removeBinary:S,icon:A,size:I,isImage:R,hasValidSize:w,getIdFromUrl:x,readDataUri:U,decodeDataUri:F,save:N,detail:P,remove:L,getDataUri:M,getText:k});return V}e.$inject=["$q","$upload","$http","$rootScope","$window","c8yBase","c8yInventory","c8yAuth","c8ySettings","c8yBinaryCommon"],angular.module("c8y.core").factory("c8yBinary",e)}(),function(){"use strict";function e(e,t,n,r){function a(e,n){var r={method:"POST",data:{filesize:e.size},file:e},a=_.assign({},r,n);return t.upload(a)}function i(t,n,a){var i=e.defer(),u=new XMLHttpRequest;return u.open("GET",n,!0),u.responseType="arraybuffer",u.onload=function(){200===u.status?i.resolve(u):i.reject(u)},u.onprogress=function(e){if(!_.isUndefined(e.loaded)){var n=_.isNumber(Number(a))&&a||o(t);if(!_.isUndefined(n)){var r=e.loaded/n;i.notify(r)}}},_.forEach(r.headers(),function(e,t){e&&u.setRequestHeader(t,e)}),c.__test?c.__downloadDeferred=i:u.send(),i.promise}function o(e){var t=_.get(e,"length"),n=_.get(e,"_attachments"),r=_.get(n,_.first(_.keys(n)));return _.isUndefined(t)?_.get(r,"length"):t}function u(e){return/filename="(.*)"/.exec(e)[1]}function s(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,a=0;a<r;a++)t+=String.fromCharCode(n[a]);return btoa(t)}var c={upload:a,download:i,getFilenameFromContentDisposition:u,arrayBufferToBase64:s,size:o};return c}e.$inject=["$q","$upload","c8yBase","c8yAuth"],angular.module("c8y.core").factory("c8yBinaryCommon",e)}(),angular.module("c8y.core").factory("c8yCepModule",["$http","$q","$timeout","c8yBase","c8yCepModuleExamples",function(e,t,n,r,a){"use strict";function i(t){var n=r.url(E+"/"+t.id),a={headers:r.contentHeaders(S,!0)},i={status:t.status};if(!t.id)throw new Error("Module id no defined");return e.put(n,i,a)}function o(t){var n=t.id,a=r.url(E+(n?"/"+n:"")),i=n?"put":"post",o=_.assign(r.contentHeaders(S,!0),{"Content-Type":"text/plain"}),u={headers:o};return e[i](a,t.body,u)}function u(t){var n=r.url(E),a=r.pageSizeFilter(t),i={params:a},o=r.cleanListCallback("modules",u,a);return e.get(n,i).then(s).then(o)}function s(e){return e.data.modules=_.filter(e.data.modules,function(e){return!c(e)}),e}function c(e){return e&&/^smartRule\d+$/.test(e.name)}function l(t){var n=r.url(E),a=r.pageSizeFilter(t),i={params:a},o=r.cleanListCallback("modules",l,a);return e.get(n,i).then(o)}function f(n){var a=n.id||n,i=r.url(E+"/"+a),o=t.defer(),u=null,s=null,c={headers:{"Content-Type":"text/plain",Accept:"text/plain"}},l={headers:{Accept:r.mimeType(S)}},f=function(){if(u&&s){s.name=u.match(/module (\w*);\s*\n*/)[1],s.body=u.replace(/module (\w*);\s*\n*/,""),o.resolve(s)}};return e.get(i,l).then(function(t){s=t.data,e.get(i+"?text",c).success(function(e){u=e,f()})}),o.promise}function d(t){var n=t.id||t,a=r.url(E+"/"+n);return e.delete(a)}function p(e){var n,r=t.defer(),a=_.cloneDeep(e);return a.body?(a.name&&(a.body="module "+a.name+";\n"+a.body),n=o(a).then(null,function(e){return r.reject(e),t.reject()})):n=f(a),n.then(function(e){var t=e.body?e:e.data;a.status&&t.status!==a.status?(t.status=a.status,i(t).then(function(e){r.resolve(e.data)},function(e){r.reject(e.data)})):r.resolve(t)}),r.promise}function m(e){return l().then(function(n){var r;return n.forEach(function(t){if(t.name===e)return r=t,!1}),r||t.reject("not found")})}function g(e){var t=e.name;return A[t]||(A[t]=m(t).then(function(e){return"DEPLOYED"!==e.status?(e.status="DEPLOYED",p(e)):e},function(){return p(e)})),A[t]}function h(e){return e.status="DEPLOYED",p(e)}function v(e){return y(e).then(h)}function y(e){return e.status="NOT_DEPLOYED",p(e)}function T(){return t.when(a)}var E="cep/modules",S="cepModule",A={};return{list:u,listWithSmartRules:l,isSmartRuleModule:c,detail:f,save:p,remove:d,examples:T,detailByName:m,createOrDeploy:g,deploy:h,redeploy:v,undeploy:y}}]).factory("c8yCepModuleExamples",["gettext",function(e){return[{name:e("Change the severities of alarms based on activity time"),value:'/* Create "context" - definition of a group of events to be processed separately.\n * Context "Alarms" consists of AlarmCreated and AlarmUpdated: \n * with the same source and type = "power off". */\ncreate context Alarms partition by \nalarm.source from AlarmCreated(alarm.type = "power off"),\nalarm.source from AlarmUpdated(alarm.type = "power off");\n\n/* Update severity for all active AlarmCreated \n * after which there is no change to other status in 15 minutes. */\ncontext Alarms \ninsert into UpdateAlarm \nselect \n   a.alarm.id as id,\n   "MAJOR" as severity\nfrom pattern [\n   every a = AlarmCreated(alarm.status = CumulocityAlarmStatuses.ACTIVE) \n   -> (timer:interval(15 minutes) \n      and not AlarmUpdated(alarm.status != CumulocityAlarmStatuses.ACTIVE))\n];'},{name:e("Create alarm if temperature was to low for 15 minutes"),value:'create schema NotZeroMeasurementCreated (\n  measurement Measurement\n);\ncreate schema ZeroMeasurementCreated (\n  measurement Measurement\n);\ncreate schema CheckTimeDifference (\n  firstMeasurement Measurement,\n  lastMeasurement Measurement\n);\ninsert into CreateAlarm\n  select\n    check.lastMeasurement.source as source,\n    check.lastMeasurement.time as time,\n    "c8y_LowTemperatureAlarm" as type,\n    CumulocitySeverities.WARNING as severity,\n    CumulocityAlarmStatuses.ACTIVE as status,\n    "Temperature was too low for more than 15 minutes" as text\n  from CheckTimeDifference check\n  where check.lastMeasurement.time.after(check.firstMeasurement.time, 15min);\ninsert into CheckTimeDifference\n  select\n    firstZero.measurement as firstMeasurement,\n    firstNotZeroAgain.measurement as lastMeasurement\n  from pattern [\n    every (lastNotZero = NotZeroMeasurementCreated ->\n    firstZero = ZeroMeasurementCreated(measurement.source.value = lastNotZero.measurement.source.value)) ->\n    ZeroMeasurementCreated until firstNotZeroAgain = NotZeroMeasurementCreated(measurement.source.value = lastNotZero.measurement.source.value)\n  ];\ninsert into NotZeroMeasurementCreated\n  select\n    m.measurement as measurement\n  from\n    MeasurementCreated m\n  where getNumber(m, "c8y_TemperatureMeasurement.T.value") > 0\n  AND m.measurement.type = "c8y_TemperatureMeasurement";\ninsert into ZeroMeasurementCreated\n  select\n    m.measurement as measurement\n  from\n    MeasurementCreated m\n  where getNumber(m, "c8y_TemperatureMeasurement.T.value") <= 0\n  AND m.measurement.type = "c8y_TemperatureMeasurement";'},{name:e("Create alarm on not processed operation"),value:'create constant variable int operation_timeout_in_seconds = 300; \ncreate constant variable string alarm_severity = "MAJOR"; \ncreate constant variable string alarm_text = "Operation with id=#{id.value} haven\'t been finished!"; \ncreate constant variable string alarm_type = "c8y_OperationNotFinished"; \ncreate schema OperationNotFinished ( operation com.cumulocity.model.operation.Operation ); \ncreate schema OperationFinished ( operation com.cumulocity.model.operation.Operation, alarm Alarm); \n@Name("create_alarm_from_not_finished_operation")\ninsert into CreateAlarm\n  select \n    operation.deviceId as source,\n    "ACTIVE" as status,\n    alarm_severity as severity,\n    alarm_type as type,\n    current_timestamp().toDate() as time,\n    replaceAllPlaceholders(alarm_text, operation) as text,\n    { "operationId", operation.id.value } as fragments \n  from OperationNotFinished;\n@Name("handle_not_finished_operation")\ninsert into OperationNotFinished\n  select\n    prevOp.operation as operation\n  from pattern [ \n    every prevOp = OperationCreated \n    -> (timer:interval(operation_timeout_in_seconds second)\n    and not OperationUpdated(\n    operation.id.value = prevOp.operation.id.value\n    and (operation.status in (OperationStatus.SUCCESSFUL, OperationStatus.FAILED))\n    ))  ];\n'},{name:e("Create alarm when temperature below 0 degree"),value:'insert into CreateAlarm \n  select\n    e.measurement.time as time,\n    e.measurement.source.value as source,\n    "com_cumulocity_TemperatureAlert" as type,\n    "Temperature too low" as text,\n    "ACTIVE" as status,\n    "CRITICAL" as severity\n  from MeasurementCreated e\n  where getNumber(e, "c8y_TemperatureMeasurement.T.value") < 0'},{name:e("Create alarm when temperature over 100 degree"),value:'insert into CreateAlarm \n  select\n    e.measurement.time as time,\n    e.measurement.source.value as source,\n    "com_cumulocity_TemperatureAlert" as type,\n    "Temperature too high" as text,\n    "ACTIVE" as status,\n    "CRITICAL" as severity\n  from MeasurementCreated e\n  where getNumber(e, "c8y_TemperatureMeasurement.T.value") > 100'},{name:e("Create close relay operation when temperature readings over 100 degree"),value:'insert into CreateOperation\n  select\n    "PENDING" as status,\n    «heating ID» as deviceId,\n    {\n      "c8y_Relay.relayState", "CLOSED"\n    } as fragments\n  from MeasurementCreated e\n  where getNumber(e, "c8y_TemperatureMeasurement.T.value") > 100'},{name:e("Display current temperature on device"),value:'expression string js:prepareText(temp) [\n  function format(text, params){\n    for(param in params) {\n        text = text.replace("{" + param + "}", params[param])\n    }\n    return text\n  }\n  format("Current temperature is {0}", [temp])\n]\ninsert into CreateOperation\n\tselect\n      "PENDING" as status,\n      e.measurement.source.value as deviceId,\n      { "c8y_Message.text", prepareText(\n        getNumber(e, "c8y_TemperatureMeasurement.T.value")\n\t   ) } as fragments\n    from MeasurementCreated e\n    where e.measurement.type = "c8y_TemperatureMeasurement";'},{name:e("Schedule device restart every day at 1am"),value:'insert into CreateOperation\nselect\n  "PENDING" as status,\n  «device ID» as deviceId,\n  { "c8y_Restart", {} } as fragments\nfrom pattern [every timer:at(*, 1, *, *, *, *)];'},{name:e("Select location change event once for 60 seconds"),value:'select * from EventCreated e\nwhere getObject(e, "c8y_LocationMeasurement") is not null\noutput first every 60 seconds'},{name:e("Select temperature readings over 100 degree"),value:'select * from MeasurementCreated e\nwhere getNumber(e, "c8y_TemperatureMeasurement.T.value") > 100'},{name:e("Send alarms that are active since 30 minutes to email"),value:'insert into SendEmail\nselect\n  "<RECEIVER@COMPANY.COM>" as receiver,\n  "Alarm active since 30 mins: " || e.alarm.text as subject,\n  "Time: " || e.alarm.time.format() || \n  " Severity: " || e.alarm.severity.name() || \n  " Source: " || findManagedObjectById(e.alarm.source.value).getName() as text,\n  "<REPLY_TO@COMPANY.COM>" as replyTo\nfrom pattern [\n   every e = AlarmCreated(alarm.status = CumulocityAlarmStatuses.ACTIVE, alarm.severity = CumulocitySeverities.CRITICAL) \n   -> (timer:interval(30 minutes) \n      and not AlarmUpdated(alarm.status != CumulocityAlarmStatuses.ACTIVE, alarm.id.value = e.alarm.id.value))\n];'},{name:e("Send sales to Zapier"),value:'@Name("sales")\nselect\n  getString(e, "com_nsn_startups_vendme_fragments_SalesReportInfo.vendingMachine_name") as id,\n  getString(e, "com_nsn_startups_vendme_fragments_SalesReportInfo.product_name") as name,\n  e.event.time.format() as time,\n  getNumber(e, "com_nsn_startups_vendme_fragments_SalesReportInfo.totalPaid") as value,\n  getString(e, "com_nsn_startups_vendme_fragments_SalesReportInfo.payment_type") as text\nfrom EventCreated e\n  where e.event.type = "com_nsn_startups_vendme_LiveSalesReport"\n'},{name:e("Send simulator temperature to Zapier"),value:'@Name("simulatortemperature")\nselect\n  e.measurement.source.value as id,\n  findManagedObjectById(e.measurement.source.value).getName() as name,\n  e.measurement.time.format() as time,\n  getNumber(e, "c8y_TemperatureMeasurement.T.value") as value,\nfrom MeasurementCreated e\n  where e.measurement.type = "TemperatureMeasurement"\n'}]}]),function(){"use strict";function e(e){function t(t){return e.listByUser().then(function(e){return!!_.find(e,{key:"combain-application-key"})&&!(!t.c8y_CellInfo&&!t.c8y_Mobile)})}return{gsmTrackingAvailable:t}}e.$inject=["c8yApplication"],angular.module("c8y.core").factory("c8yCombain",e)}(),function(){"use strict";function e(e,t,n,r){function a(t,r,a,i,o){var u,s,c=[n.url(d)],l=["prefix","mo","suffix"];return p[t].mo?p[t].mo=r:delete p.mo,_.forEach(l,function(e){p[t][e]&&c.push(p[t][e])}),u=c.join("/"),s={method:[p[t].method],url:u,data:a,params:i,headers:{Accept:"application/json","Content-type":"application/json;charset=UTF-8"}},s=_.assign(s,o||{}),e(s)}function i(e,t,r,a,i){return o(e,t,r,a,i).then(n.getResData)}function o(e,n,r,i,o){return n&&e?a(e,n,r,i,o):t.reject("Device not valid")}function u(e){return r.update({valid:e})}function s(e){var n=e&&(200===e.status||400===e.status),r=n&&200===e.status;return n?u(r).then(function(){return e}):t.reject(e)}function c(){return o("ping","mo",{},{},{silentError:!0}).then(s,s)}function l(e){return e.valid?c():t.reject()}function f(){return r.detail().then(l)}var d="service/connectivity",p={getTerminalDetails:{prefix:"mo",suffix:"op/terminal",mo:!0,method:"GET"},getTerminalSessionInfo:{prefix:"mo",suffix:"op/terminal/session",mo:!0,method:"GET"},setTerminalSimStatus:{prefix:"mo",suffix:"op/terminal/sim_status",mo:!0,method:"PUT"},getTerminalAuditLogs:{prefix:"mo",suffix:"op/terminal/audit",mo:!0,method:"GET"},getTerminalUsage:{prefix:"mo",suffix:"op/billing",mo:!0,method:"GET"},getTerminalVoiceUsage:{prefix:"mo",suffix:"op/billing/voice",mo:!0,method:"GET"},getTerminalDataUsage:{prefix:"mo",suffix:"op/billing/data",mo:!0,method:"GET"},getTerminalSmsUsage:{prefix:"mo",suffix:"op/billing/sms",mo:!0,method:"GET"},sendSms:{prefix:"mo",suffix:"op/sms",mo:!0,method:"POST"},getSms:{prefix:"mo",suffix:"op/sms",mo:!0,method:"GET"},getSmsDetails:{prefix:"mo",suffix:"op/sms/details",mo:!0,method:"GET"},ping:{suffix:"op/ping",mo:!1,method:"GET"}};return{detail:i,getTerminalDetails:_.partial(i,"getTerminalDetails"),getTerminalSessionInfo:_.partial(i,"getTerminalSessionInfo"),setTerminalSimStatus:_.partial(i,"setTerminalSimStatus"),getTerminalAuditLogs:_.partial(i,"getTerminalAuditLogs"),getTerminalUsage:_.partial(i,"getTerminalUsage"),getTerminalVoiceUsage:_.partial(i,"getTerminalVoiceUsage"),getTerminalDataUsage:_.partial(i,"getTerminalDataUsage"),getTerminalSmsUsage:_.partial(i,"getTerminalSmsUsage"),getSms:_.partial(i,"getSms"),sendSms:_.partial(i,"sendSms"),getSmsDetails:_.partial(i,"getSmsDetails"),ping:c,safePing:f}}angular.module("c8y.core").factory("c8yConnectivity",["$http","$q","c8yBase","c8yConnectivitySettings",e])}(),function(){"use strict";function e(e,t,n){function r(n,r){return r&&r.microservice&&r.microservice.url&&delete r.microservice,e({method:n,url:o,data:r,headers:{Accept:"application/json","Content-type":"application/json"}}).then(t.getResData).then(function(e){return e.valid="true"===e.valid,e})}function a(){return r("GET").then(function(e){return!!e["microservice.url"]}).catch(function(){return!1})}function i(){var e={category:"connectivity",key:"microservice.url"};return n.getSystemOptionValue(e,!1).then(function(e){return!!e})}var o=t.url("service/register/connectivity");return{detail:_.partial(r,"GET"),update:_.partial(r,"PUT"),exists:a,shouldShow:i}}angular.module("c8y.core").factory("c8yConnectivitySettings",["$http","c8yBase","c8ySettings",e])}(),function(){"use strict";function e(e,t,n){function r(e){e=_.cloneDeep(e);var t=this;if(this.properties=null,this.filterFn=null,this.dependencies=null,_.isArray(e)){if(!function(e){var n=e.length,r=_.last(e);return _.isArray(r)?(t.dependencies=r,t.filterFn=e[n-2],t.properties=e.slice(0,n-2),_.isFunction(t.filterFn)&&_.every(t.properties,String)):!!_.isFunction(r)&&(t.dependencies=_.initial(e),t.filterFn=r,t.properties=t.dependencies,_.every(t.properties,String))}(e))throw new Error("property map is not valid")}else{if(!_.isString(e))throw new Error("parameter is invalid");!function(e){t.properties=[e],t.filterFn=function(t,n){return _.isEqual(t,n[e])},t.dependencies=[e]}(e)}}function a(e,t){var n=this;this.pickList=null,this.queryParams=e,this.propertyMapList=t&&_.map(t,function(e){return new r(e)})||[],function(){e=_.pickBy(e,function(e){return void 0!==e})}(),function(){_.forEach(_.keys(e),function(e){_.some(n.propertyMapList,function(t){return _.some(t.properties,function(t){return t===e})})||n.propertyMapList.push(new r(e))})}(),function(){var e=_.reduce(n.propertyMapList,function(e,t){return _.forEach(t.dependencies,function(t){e[t]=!0}),e},{});e.id=!0,n.pickList=_.keys(e)}()}function i(r,i){function o(){if(i){var t=n.realtimeActions();return _.forEach(t,function(e){n.addListener(T.__realtimeId,i,e,s)}),e.when(n.start(T.__realtimeId,i))}}function u(){i&&n.removeSubscriber(T.__realtimeId,i)}function s(e,t){if(!E){var n=T.count;I[e.name||e](t),d();var r=T.count;v&&r!==n&&v(r,n)}}function c(e){S?m(e)&&g.unshift(p(e)):h+=1}function l(e){if(S){var t=_.findIndex(g,{id:e.id});-1===t&&m(e)?g.unshift(p(e)):-1===t||m(e)||g.splice(t,1)}}function f(e){if(S){var t=_.findIndex(g,{id:e.id});-1!==t&&g.splice(t,1)}else h-=1}function d(){T.count=g&&g.length||h||0}function p(e){return _.pick(e,y.pickList)}function m(e){return y.matches(e)}if(!_.isFunction(r))throw new Error("list function must be provided");var g,h,v,y,T=this,E=!1,S=!1,A={pageSize:1},b=!1,C=!1,I={CREATE:c,UPDATE:l,DELETE:f};t.createLocalId(this,"__realtimeId"),this.start=function(){if(b)throw new Error("Cannot restart a counter instance, please create a new instance");return b=!0,this.refresh().then(o)},this.stop=function(){if(!b)throw new Error("Cannot stop counter instance without starting it first");if(C)throw new Error("Cannot stop an already stopped counter instance");C=!0,u()},this.onNotification=function(e){v=e},this.refresh=function(){E=!0;var t=S?y.queryParams:A;return e.when(r(t)).then(function(e){S?g=_(e).filter(m).map(p).value():h=e.statistics.totalPages,d(),E=!1})},this.filter=function(e,t){if(!e&&!t)return A;if(S)throw new Error("filter can be set only once");S=!0,y=new a(e,t)}}return r.prototype.matches=function(e,t){e=_.cloneDeep(e),_.forEach(this.properties,function(t){e[t]=e[t]||void 0});var n=_.values(_.pick(e,this.properties));return n.push(t),this.filterFn.apply(this,n)},a.prototype.matches=function(e){var t=this;return _.every(this.propertyMapList,function(n){return n.matches(t.queryParams,e)})},{Counter:i,defaultPropertyMaps:{date:["dateFrom","dateTo",function(e,t,n){var r=n&&(n.date||n.time);return!!r&&((!e||!moment(e).isAfter(r))&&(!t||!moment(t).isBefore(r)))},["date","time"]],source:["source",function(e,t){return(t&&t.source&&t.source.id)===e},["source"]]}}}angular.module("c8y.core").factory("c8yCounter",["$q","c8yBase","c8yRealtime",e])}(),function(){"use strict";function e(e,t){function n(e){var n=e.id||e;return t.url(v+"/"+n)}function r(n,i){var o=t.url(v),u=t.pageSizeNoTotalFilter(n),s={params:u,silentError:i},c=t.cleanListCallback("bulkOperations",r,u);return e.get(o,s).then(c).then(_.partialRight(a,u.status))}function a(e,t){var n;if(_.isUndefined(t))n=e;else{_.isArray(t);n=_.filter(e,function(e){return _.includes(t,p(e))})}return n}function i(t){var r=n(t);return e.get(r)}function o(e){return e.id?c(e):u(e)}function u(n){var r=t.url(v),a=T(n,S),i=_.cloneDeep(E);return e.post(r,a,i).then(s)}function s(e){var t=new RegExp(y),n=e.headers("Location").match(t);return parseInt(n[1],10)}function c(n){var r=t.url(v+"/"+n.id),a=T(n,S.concat(A)),i=_.cloneDeep(E);return e.put(r,a,i)}function l(e){var t=e&&e.status;return _.includes([I.ACTIVE,I.IN_PROGRESS],t)}function f(t){var r=n(t);return e.delete(r)}function d(e){var t=_.cloneDeep(e);return delete t.groupId,t.failedParentId=e.id,u(t)}function p(e){return"CANCELED"===e.status||"DELETED"===e.status?b.CANCELLED:!e.progress||!e.progress.all||0===e.progress.pending&&0===e.progress.executing&&0===e.progress.successful&&0===e.progress.failed?b.SCHEDULED:e.progress&&e.progress.successful+e.progress.failed<e.progress.all?b.EXECUTING:e.progress.failed>0?b.COMPLETED_WITH_FAILURES:b.COMPLETED_SUCCESSFULLY}function m(e){var t=_.isObjectLike(e)?p(e):e;return w[t]}function g(e,t){var n=_.isObjectLike(e)?p(e):e,r=h(t);return _.includes(r,n)}function h(e){return R[e]}var v="devicecontrol/bulkoperations",y="\\/devicecontrol\\/bulkoperations\\/(\\d+)",T=t.cleanFields,E={headers:t.contentHeaders("bulkOperation")},S=["creationTime","id","self","operations"],A=[],b={SCHEDULED:"SCHEDULED",EXECUTING:"EXECUTING",COMPLETED_WITH_FAILURES:"COMPLETED_WITH_FAILURES",COMPLETED_SUCCESSFULLY:"COMPLETED_SUCCESSFULLY",CANCELLED:"CANCELLED"},C=_.keys(b),I={ACTIVE:"ACTIVE",IN_PROGRESS:"IN_PROGRESS",COMPLETED:"COMPLETED",DELETED:"DELETED"},R={PENDING:[b.SCHEDULED],EXECUTING:[b.EXECUTING],SUCCESSFUL:[b.COMPLETED_SUCCESSFULLY],FAILED:[b.COMPLETED_WITH_FAILURES,b.CANCELLED]},w={};return w.SCHEDULED={label:"SCHEDULED",icon:"clock-o",cls:"text-muted"},w.EXECUTING={label:"EXECUTING",icon:"refresh",cls:"text-info"},w.COMPLETED_WITH_FAILURES={label:"COMPLETED WITH FAILURES",icon:"times-circle",cls:"text-danger"},w.COMPLETED_SUCCESSFULLY={label:"COMPLETED SUCCESSFULLY",icon:"check-circle",cls:"text-success"},w.CANCELLED={label:"CANCELLED",icon:"times-circle",cls:"text-danger"},{list:r,detail:i,create:u,save:o,update:c,canCancel:l,cancel:f,retryFailed:d,status:b,statusList:C,getStatus:p,getStatusStyle:m,doesMatchSingleOpStatus:g,getMappedSingleOpStatus:h}}angular.module("c8y.core").factory("c8yDeviceBulkControl",["$http","c8yBase",e])}(),function(){"use strict";function e(e,t,n,r,a,i,o){function u(e){var t=e.id||e;return r.url(T+"/"+t)}function s(t){var n=r.url(T),a=r.pageSizeNoTotalFilter(t),i={params:a},o=r.cleanListCallback("operations",s,a);return e.get(n,i).then(o)}function c(e){var t=n.defer(),r=_.assign(e||{},{pageSize:1e3}),a=!1,i=function(e){var n=!_.isUndefined(e.paging.next)&&e.length>=r.pageSize;return t.notify(e),n||t.resolve(!0),!!a||(!n||e.paging.next().then(i))};return _.assign(t.promise,{cancel:function(){a=!0,t.reject("canceled")}}),s(r).then(i),t.promise}function l(t){var n=u(t);return e.get(n)}function f(t){var n=r.url(T),a=y(t,C),i=_.cloneDeep(S);if(!a.deviceId)throw new Error("c8yDeviceControl: data must have a deviceId property");return e.post(n,a,i).then(d).finally(function(e){return w.$emit("create"),e})}function d(e){var t=new RegExp(E),n=e.headers("Location").match(t);return parseInt(n[1],10)}function p(e){var t=f(e),r=t.then(function(t){e.id=t;var r=n.defer(),i="operation"+e.id,o="/operations/"+e.deviceId;return a.addListener(i,o,"UPDATE",function(t,n){n.id==e.id&&(n.status===A.SUCCESSFUL||n.status===A.FAILED?(a.stop(i,o),r.resolve(n)):r.notify(n))}),a.start(i,o),r.promise});return n.when({created:t,completed:r})}function m(t){var n=r.url(T)+"/"+t.id,a=y(t,C.concat(I)),i=_.cloneDeep(S);return e.put(n,a,i).finally(function(){w.$emit("update")})}function g(e){return e.status=A.FAILED,e.failureReason=i("Operation cancelled by user."),m(e)}function h(e){return e.id?m(e):f(e)}function v(e){var t=_.isString(e)?e:e.status;return R[t.toUpperCase()]}var y=r.cleanFields,T="devicecontrol/operations",E="\\/devicecontrol\\/operations\\/(\\d+)",S={headers:r.contentHeaders("operation")},A={PENDING:i("PENDING"),SUCCESSFUL:i("SUCCESSFUL"),EXECUTING:i("EXECUTING"),FAILED:i("FAILED")},b=_.keys(A),C=["creationTime","deviceExternalIDs","id","self"],I=["deviceId","deviceName","bulkOperationId"],R={};this.reservedKeys=C.concat(["deviceId","deviceName","bulkOperationId"]),this.standardKeys={failureReason:i("Failure reason"),description:i("Description"),status:i("Status")};var w=t.$new(!0);R[A.PENDING]={icon:"clock-o",cls:"text-muted"},R[A.EXECUTING]={icon:"refresh",cls:"text-info"},R[A.SUCCESSFUL]={icon:"check-circle",cls:"text-success"},R[A.FAILED]={icon:"times-circle",cls:"text-danger"},_.assign(this,{list:s,listPaged:c,detail:l,create:f,createWithNotifications:p,update:m,cancel:g,save:h,status:A,statusList:b,getStyle:v,events:w}),_.assign(this,o),_.bindAll(this,_.keys(o))}angular.module("c8y.core").service("c8yDeviceControl",["$http","$rootScope","$q","c8yBase","c8yRealtime","gettext","KeysMixin",e])}(),angular.module("c8y.core").factory("c8yDeviceGroup",["c8yInventory",function(e){"use strict";function t(e){return!!e.childAssets.references.length}var n={};return n.list=function(t){var n={fragmentType:"c8y_IsDeviceGroup",pageSize:1e4};return _.isObjectLike(t)&&(n=_.assign(n,t)),e.list(n)},n.detail=function(t){return e.detail(t)},n.create=function(t){return t.type="c8y_DeviceGroup",e.create(t)},n.remove=function(n){return!t(n)&&e.remove(n)},n.addDevice=function(t,n){return n.c8y_Groups=_.isArray(n.c8y_Groups)?n.c8y_Groups:[],n.c8y_Groups.push({name:t.name,id:t.id}),e.update(n.id,{c8y_Groups:n.c8y_Groups}),e.addChildAsset(t,n)},n.removeDevice=function(t,n){return n.c8y_Groups=n.c8y_Groups.filter(function(e){return e.id!==t.id}),e.update(n.id,{c8y_Groups:n.c8y_Groups}),e.removeChildAsset(t,n)},n}]),function(){"use strict";function e(e,t,n,r,a,i,o){function u(e){var t=e.id||e;return n.url(I+"/"+encodeURIComponent(t))}function s(t){var r=n.url(I),a=n.pageSizeFilter(t),i={params:a},o=n.cleanListCallback("newDeviceRequests",s,a);return e.get(r,i).then(o)}function c(t){var n=u(t);return e.get(n)}function l(t){var r=n.url(I),a=C(t,O),i=_.cloneDeep(w);if(!a.id)throw new Error("c8yDeviceRegistration: data must have an id property");return e.post(r,a,i)}function f(e,t){var a=_.assign({url:n.url(R),method:"POST",headers:{Accept:"application/json"},file:e},t||{});return r.upload(a)}function d(t){E(t);var n=u(t),r={status:N.ACCEPTED},a=_.cloneDeep(w);return e.put(n,r,a)}function p(t){var n=u(t);return e.delete(n)}function m(e){var t=e.status||"UNKNOWN";return P[t.toUpperCase()]}function g(e){return m(e).icon}function h(e){return m(e).cls}function v(e){return L.push(e),function(){var t=L.indexOf(e);t>-1&&L.splice(t,1)}}function y(){L.length=0}function T(){var e=L.length,t="_deviceRegistration",n="/managedobjects/*",r=o.getStatus(t,n);!T.addedListener&&e&&(o.addListener(t,n,"CREATE",A),T.addedListener=!0),!r&&e&&o.start(t,n),r&&!e&&o.stop(t,n)}function E(e){var t=e.id||e,n="device_"+t;M.push(n),T()}function S(e){return M.indexOf(e.owner)>-1}function A(e,n){if(S(n)){var r={managedObject:n};_.forEach(L,function(e){t.invoke(e,b,r)})}}var b=this,C=n.cleanFields,I="devicecontrol/newDeviceRequests",R="devicecontrol/bulkNewDeviceRequests",w={headers:n.contentHeaders("newDeviceRequest")},N={WAITING_FOR_CONNECTION:"WAITING_FOR_CONNECTION",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",ACCEPTED:"ACCEPTED"},D=_.keys(N),O=[],P={},L=[],M=[];this.reservedKeys=[],this.standardKeys={},a("WAITING FOR CONNECTION"),a("PENDING ACCEPTANCE"),a("ACCEPTED"),P[N.WAITING_FOR_CONNECTION]={icon:"unlink",cls:"text-danger"},P[N.PENDING_ACCEPTANCE]={icon:"circle",cls:"text-info"},P[N.ACCEPTED]={icon:"check-circle",cls:"text-success"},window.jasmine&&(b._onMoCreate=A,b._runHooks=E,b._registrationHooks=L),_.assign(this,{list:s,detail:c,create:l,bulkCreate:f,accept:d,cancel:p,status:N,statusList:D,getStyle:m,statusIcon:g,statusClass:h,addHook:v,clearHooks:y}),_.assign(this,i),_.bindAll(this,_.keys(i))}angular.module("c8y.core").service("c8yDeviceRegistration",["$http","$injector","c8yBase","$upload","gettext","KeysMixin","c8yRealtime",e])}(),function(){"use strict";function e(e,t,n,r){function a(e){var n=window.c8y&&window.c8y.collections&&window.c8y.collections.devicecommands||{},r=n[e];return r&&t.when(r)}function i(t){var r=o(t);return(a(t)||e.get(r).then(n.getResData)).then(_.partial(u,t))}function o(e){return n.dataFilePath("devicecommands/")+e+".json"}function u(e,n){var r;return r=_.isArray(n)?_(n).map(function(t){return s(t.templates,t.syntax,e)}).flatten().value():s(n.templates,n.syntax,e),t.when(r)}function s(e,t,n){return _.map(e||[],function(e){return _.assign(e,{syntax:t,deviceType:n})})}function c(){return r.getSystemOptionValue({category:"messaging",key:"provider"},!1).then(function(e){return!!e})}return{getCommandTemplatesForDeviceType:i,canSendCommandsViaSMS:c}}angular.module("c8y.core").factory("c8yDeviceShell",["$http","$q","c8yBase","c8ySettings",e])}(),angular.module("c8y.core").factory("c8yDeviceStatus",["$filter","c8yBase","gettext","gettextCatalog",function(e,t,n,r){"use strict";function a(e){var t=e&&e.c8y_RequiredAvailability,n=l(e);if("MAINTENANCE"===n)var r={sendStatus:!1,pushStatus:!1,maintenanceStatus:{icon:f.device.MAINTENANCE.icon,class:f.device.MAINTENANCE.class,tooltip:u(e)}};else var a=n||(t?"UNKNOWN":"NOT_MONITORED"),s=e&&e.c8y_Connection&&e.c8y_Connection.status||"UNKNOWN",r={sendStatus:{icon:f.sendData[a].icon,class:f.sendData[a].class,status:a,tooltip:i(e)},pushStatus:{icon:f.push[s].icon,class:f.push[s].class,status:s,tooltip:o(e,"CONNECTED"===s)},maintenanceStatus:!1};return r}function i(t){var a=t&&t.c8y_Availability,i=a&&a.lastMessage;return i?r.getString("Last request from device to server:<br>{{date}}",{date:e("absoluteDate")(i)}):n("Connection not monitored")}function o(e,t){return n(t?"Push connection: active":"Push connection: inactive")}function u(e){return n("Under maintenance")}function s(e){return"AVAILABLE"===l(e)}function c(e){return"MAINTENANCE"===l(e)}function l(e){return e&&e.c8y_Availability&&e.c8y_Availability.status}var f={sendData:{AVAILABLE:{icon:"long-arrow-right",class:"statusOk"},UNAVAILABLE:{icon:"long-arrow-right",class:"statusNok"},UNKNOWN:{icon:"long-arrow-right",class:"statusUnknown"},NOT_MONITORED:{icon:"long-arrow-right",class:"statusUnknown"}},push:{CONNECTED:{icon:"long-arrow-left",class:"statusOk"},DISCONNECTED:{icon:"long-arrow-left",class:"statusUnknown"},UNKNOWN:{icon:"long-arrow-left",class:"statusUnknown"}},device:{MAINTENANCE:{icon:"wrench",class:"statusAlert"}}};return{status:a,isDeviceAvailable:s,isDeviceMaintenance:c}}]),function(){"use strict";function e(e,t,n,r,a,i,o,u){function s(e){return _.assign({skipChildrenNames:!0,fragmentType:q},e||{})}function c(e){return!!e[q]}function l(e){var t=z;return c(e)||-1===V.indexOf(e.type)&&!_.find(t,function(t){return!_.isUndefined(e[t])})}function f(e){var t=s(e),n=o.list(t);return t.text&&(n=n.then(J)),n}function d(e){e=e||{};var t=_.omit(s(e),["fragmentType","query"]);return(e.query?o.listQuery(e.query,t):o.list(t)).then(Z)}function p(e){
var t=_.cloneDeep(e);t[q]=!0,o.create(t)}function m(e){return e.id?I(e):p(e)}function g(e,t){var n=e&&e.c8y_SupportedOperations;return!!(_.isArray(n)&&n.indexOf(t)>-1)}function h(e){var t=[];return _.isArray(e.c8y_SupportedOperations)&&(t=e.c8y_SupportedOperations),t}function v(e){return"com_nsn_startups_vendme_VendingMachine"===e.type}function y(e){var t=e&&e.c8y_RequiredAvailability,n=e&&e.c8y_Availability;return n&&n.status||(t?"UNKNOWN":"NOT_MONITORED")}function T(e){return Y[y(e)].icon}function E(e){return Y[y(e)].cls}function S(e){return W[C(e)].color}function A(e){return W[C(e)].icon}function b(e){return W[C(e)].tooltipText}function C(e){if(e.c8y_Availability&&e.c8y_Availability.lastMessage&&e.c8y_RequiredAvailability&&e.c8y_RequiredAvailability.responseInterval){return moment().valueOf()-moment(e.c8y_Availability.lastMessage).valueOf()-6e4*e.c8y_RequiredAvailability.responseInterval>0}return null}function I(e){return R(e),o.update(e)}function R(e){var t=e&&e.id||e;Q.cache&&delete Q.cache[t]}function w(e,t){var n=_.assign(t||{},{withParents:!0}),r=o.detail(e,n);return Q.cache&&Q.cache.set(e&&(e.id||e),r),r}function N(t){var n=t&&t.id||t;return e.all([o.childDevices(n),o.childAssets(n)]).then(_.flattenDeep)}function D(e){var t=s(e);return o.getCount(t)}function O(e){return!_.isUndefined(e[q])}function P(e){return e.deviceParents.references.length>0}function L(e){var t=v(e)?"com_nsn_startups_vendme_fragments_VendingMachineTypeInfo":"c8y_Hardware",n=e&&e[t];return n&&n.model}function M(e){var t=v(e)?"com_nsn_startups_vendme_fragments_VendingMachineTypeInfo":"c8y_Hardware",n=v(e)?"serial":"serialNumber",r=e&&e[t];return r&&r[n]}function U(e){var n=e.c8y_Availability,r=n&&n.lastMessage&&t("absoluteDate")(n.lastMessage);return r?u.getString("Last message: {{date}}",{date:r}):u.getString("Connection not monitored")}function k(e){return w(e).then(function(e){var t=e.data,n=t.owner,r=t.c8y_IsDevice&&n&&n.match(/^device_/);return r=!1,r?a.detail(n).then(function(e){var t=e.data,n=a.groups(t);return _.find(n,{name:"devices"})?a.remove(t):a}):t}).then(function(){return o.remove(e)})}function x(e){var t=["name","id"];return(_.find(_.at(e,t))||u.getString("<no name>"))+""}function F(e){return _.find(_.at(e,H))}function $(t){var n=t.childAssets?t.childAssets.references:[],r=t.childDevices?t.childDevices.references:[],a=_.map(_.uniqBy(_.union(n,r),"id"),function(e){return w(e.managedObject.id)});return e.all(a).then(function(e){return _.map(e,function(e){return e.data})})}function G(e){return e&&e.c8y_RequiredAvailability&&e.c8y_RequiredAvailability.responseInterval&&0!==parseInt(e.c8y_RequiredAvailability.responseInterval,10)}function j(e){var t={id:e.id,c8y_RequiredAvailability:{}};return G(e)&&(t.c8y_RequiredAvailability.responseInterval=-e.c8y_RequiredAvailability.responseInterval),o.update(t)}function B(t){function n(t,i,u){return u?(i.unshift(a(u)),e.all([o.directParentDevices(u),o.directParentAssets(u)]).then(function(a){var u=[].concat(a[0]).concat(a[1]);if(0===u.length)return t.push(i),e.when(t);var s=[];return _.forEach(u,function(a){s.push(o.detail(a.id,{withParents:!0}).then(r.getResData).then(function(r){return e.when(n(t,_.cloneDeep(i),r))}))}),e.all(s).then(function(){return t})})):e.when(t)}function a(e){return{label:e.name||"Device "+e.id,path:u(e),icon:s(e),isDevice:O(e),isGroup:i.isGroup(e),id:e.id}}function u(e){var t="#/";return(t+=O(e)?"device":"group")+"/"+e.id}function s(e){return O(e)?"hdd-o":"folder-open"}function c(e){return _.filter(e,function(e){return _.some(_.without(e,e[e.length-1]),function(e){return e.isDevice||e.isGroup})})}function l(e){return _.sortBy(e,function(e){return-1*e.length})}var f=t?t.id||t:void 0,d=null;if(f){K[f]&&(d=e.when(K[f]));var p=Q(f).then(r.getResData).then(function(e){return n([],[],e).then(function(e){return e=c(e),e=l(e),K[f]=e,e})});d=d||p}return d||e.when([])}var q="c8y_IsDevice",z=["c8y_Dashboard","c8y_Report","c8y_Kpi","c8y_ExportConfiguration","c8y_IsBinary","c8y_NoDevice","c8y_IsDeviceGroup","c8y_Group","com_cumulocity_model_smartrest_SmartRestTemplate","com_cumulocity_model_devicesimulator_SensorTemplate","_attachments"],V=["c8y_ConfigurationDump","c8y_Firmware","c8y_SmartRule","c8y_Software"],H=["c8y_Network.c8y_LAN.ip","c8y_ModbusDevice.ipAddress"],K={},Y={CONNECTED:{icon:"exchange",cls:"statusOk"},AVAILABLE:{icon:"check-circle",cls:"statusOk"},MAINTENANCE:{icon:"wrench",cls:"statusAlert"},UNAVAILABLE:{icon:"exclamation-circle",cls:"statusNok"},UNKNOWN:{icon:"circle",cls:"statusUnknown"},NOT_MONITORED:{icon:"circle",cls:"statusUnknown"}},W={true:{icon:"check-circle",color:"green",tooltipText:"Valid"},false:{icon:"exclamation-circle",color:"red",tooltipText:"Invalid"},null:{icon:"circle",color:"#f3f3f3",tooltipText:"Unknown"}},J=r.createListFilter(c),Z=r.createListFilter(l),Q=_.memoize(w,function(e){var t=e&&(e.id||e);return w(t),t});return _.assign(_.cloneDeep(o),{list:f,searchIncludingChildDevices:d,save:m,update:I,detail:w,listChildren:N,detailCached:Q,create:p,removeWithUser:k,supportsOperation:g,getSupportedOperations:h,getChildren:$,isVendme:v,statusIcon:T,statusClass:E,parseAvailability:y,getCount:D,isDevice:O,isChildDevice:P,model:L,serial:M,availabilityTooltip:U,properName:x,getIPAddress:F,canSwitchResponseInterval:G,switchResponseInterval:j,isLastValidMessage:C,lastValidMessageColor:S,lastValidMessageTooltip:b,lastValidMessageIcon:A,getBreadcrumbsData:B,isProbablyDevice:l})}e.$inject=["$q","$filter","$cacheFactory","c8yBase","c8yUser","c8yGroups","c8yInventory","gettextCatalog"],angular.module("c8y.core").factory("c8yDevices",e)}(),function(){"use strict";function e(e,t,n,r,a,i){function o(){var e={type:g};return e[h]={},e}function u(e,t){return n({templateUrl:"/apps/core/scripts/ui/views/addDynamicGroupModal.html",controller:"addDynamicGroupModalController",resolve:{columns:_.constant(_.cloneDeep(e)),columnsConfig:_.constant(_.cloneDeep(t))}})}function s(e,n,o){return e[v]=o,e[y]=a.buildQuery(i.getQuery(n,o)),r.create(e).then(t.getResData)}function c(){return r.list({fragmentType:h})}function l(n,a){return(_.isObjectLike(n)?e.when(n):r.detail(n).then(t.getResData)).then(function(e){return r.list(_.assign({q:e[y]},a))})}function f(n){return(_.isObjectLike(n)?e.when(n):r.detail(n).then(t.getResData)).then(function(e){return e[v]})}function d(e,t,n){var o={id:e.id||e};return o[v]=n,o[y]=a.buildQuery(i.getQuery(t,n)),r.save(o)}function p(e){return Boolean(e[h]||e.type===g)}function m(n){return _.isUndefined(n)?e.when(!1):r.detailCached(n).then(t.getResData).then(function(e){return p(e)})}var g="c8y_DynamicGroup",h="c8y_IsDynamicGroup",v="c8y_UIDeviceFilterConfig",y="c8y_DeviceQueryString";return{spawnEmpty:o,createWithUI:u,create:s,getGroupList:c,getGroupItems:l,getColumnsConfig:f,saveColumnsConfig:d,isDynamicGroup:p,isDynamicGroupForId:m}}e.$inject=["$q","c8yBase","c8yModal","c8yInventory","c8yQueriesUtil","c8yFilteringSortingInventoryQueries"],angular.module("c8y.core").factory("c8yDynamicGroups",e)}(),function(){"use strict";function e(e,t,n,r,a){function i(e){var n=e.id||e;return t.url(m+"/"+n)}function o(n,r){var a=t.url(m);r=r||{},r.params=t.timeOrderFilter(t.pageSizeNoTotalFilter(n));var i=t.cleanListCallback("events",o,r.params);return e.get(a,r).then(i)}function u(t){var n=i(t);return e.get(n)}function s(n){var r=t.url(m),a=n,i=_.cloneDeep(g);return e.post(r,a,i)}function c(t){var n=i(t),r=p(t,d.reservedKeys),a=_.cloneDeep(g);return e.put(n,r,a)}function l(e){return e.id?d.update(e):d.create(e)}function f(e){var t=new n.Counter(o,"/events/*"),r=[n.defaultPropertyMaps.date,n.defaultPropertyMaps.source];if(e.type){var a=e.type;r.push([function(e){return a===e.type}])}return delete e.type,t.filter(e,r),t}var d=this,p=t.cleanFields,m="event/events",g={headers:t.contentHeaders("event","event")};this.reservedKeys=["creationTime","id","self","source","text","time","type","c8y_IsBinary"],this.standardKeys={type:r("Type")},_.assign(this,{list:o,detail:u,create:s,update:c,save:l,createCounter:f}),_.assign(this,a),_.bindAll(this,_.keys(a))}angular.module("c8y.core").service("c8yEvents",["$http","c8yBase","c8yCounter","gettext","KeysMixin",e])}(),angular.module("c8y.core").factory("c8yGeo",["$http","c8yKeys",function(e,t){"use strict";function n(t){return e.jsonp(i,{params:{format:"json",q:t}})}function r(){return this.points=[],this}function a(e){var t=e[o]||e[u];if(t){var n=Number(t.lat),r=Number(t.lng);if(!_.isNaN(n)&&!_.isNaN(r)&&Math.abs(t.lng)<=180&&Math.abs(t.lat)<=90)return{lat:n,lng:r};var a=e.name||e.source&&e.source.name;console.warn("Device",a,"has an invalid location")}}var i="//open.mapquestapi.com/nominatim/v1/search.php?key="+t.get("MAPQUESTAPI")+"&json_callback=JSON_CALLBACK";r.prototype.add=function(e){var t=this;return _.isArray(e)?(_.forEach(e,function(e){t.points.push(e)}),t):e instanceof r?(t.add(e.points),t):(this.points.push(e),t)},r.prototype.reset=function(){this.points.length=0},r.prototype.get=function(){var e={southWest:{},northEast:{}};return this.points.length||(e=null),this.points.forEach(function(t){t.lat<(e.southWest.lat||1/0)&&(e.southWest.lat=t.lat),t.lng<(e.southWest.lng||1/0)&&(e.southWest.lng=t.lng),t.lat>(e.northEast.lat||-1/0)&&(e.northEast.lat=t.lat),t.lng>(e.northEast.lng||-1/0)&&(e.northEast.lng=t.lng)}),e};var o="c8y_Position",u="com_nsn_startups_vendme_fragments_GPSCoordinates";return{geoCode:n,Bounds:r,getLocationFragment:a,c8y_Position:o,v4e_Position:u}}]),function(){"use strict";function e(e,t){function n(t){return t.type=d,e.save(t)}function r(){return e.list(p).then(a)}function a(e){return e.length>0?e[0]:i()}function i(){return{type:d,groups:o()}}function o(){return[c()]}function u(e){return(e?t.when(e):r()).then(_.partial(s,{}))}function s(e,t){var n=e||{};return _.forEach(t.groups||{},function(e){n[e.type]=e,n=s(n,e)}),n}function c(){return{type:"c8y_DeviceGroup",name:"Default Group",namePlural:"Default Groups",showInNavigator:!0,groups:[]}}function l(){return{type:"c8y_DeviceSubgroup",name:"Default Subgroup",namePlural:"Default Subgroups",showInNavigator:!1,groups:[]}}function f(){return{name:"",namePlural:"",type:"",showInNavigator:!1,groups:[]}}var d="c8y_GroupTypesConfig",p={type:d,pageSize:1};return{save:n,get:r,getLookup:u,getDeviceGroupType:c,getDeviceSubgroupType:l,getEmptyGroupType:f}}e.$inject=["c8yInventory","$q"],angular.module("c8y.core").factory("c8yGroupTypesConfig",e)}(),function(){"use strict";function e(e,t,n,r,a){function i(e){return n.listQuery(u(e),{withParents:!0},!0)}function o(e){var n=String(t.getId(e)),r=t.createListFilter(function(e){var t=_.map(_.get(e,"additionParents.references"),_.property("managedObject.id"));return!_.includes(t,n)});return i(e).then(r)}function u(e){return{__bygroupid:t.getId(e)}}function s(e){return r.getLookup().then(function(t){return[t[e]]}).then(d)}function c(){return a.mustHaveAllRoles(["ROLE_INVENTORY_READ"]).then(l,p)}function l(){return f().then(d)}function f(){return r.get().then(function(e){return e.groups})}function d(t){if(t.length>0){var r=[];return _.forEach(t,function(e){r.push(n.list({type:e.type}))}),e.all(r).then(_.flattenDeep)}return e.when([])}function p(){var e={fragmentType:"c8y_IsDeviceGroup",pageSize:1e3,withParents:!0},t=function(e){return _.reject(e,m(e))};return n.list(e).then(t)}function m(e){var t=_.keyBy(e,"id");return function(e){var n=_.map(_.get(e,"assetParents.references"),_.property("managedObject.id"));return _.some(n,function(e){return _.get(t,e)})}}function g(e){return!!e.c8y_IsDeviceGroup||"c8y_DeviceGroup"===e.type}return{getGroupItems:i,getGroupAssetsAndDevices:o,getGroupTypeItems:s,getTopLevelGroups:c,isGroup:g}}e.$inject=["$q","c8yBase","c8yInventory","c8yGroupTypesConfig","c8yPermissions"],angular.module("c8y.core").factory("c8yGroups",e)}(),angular.module("c8y.core").factory("c8yIdentity",["$http","c8yBase",function(e,t){"use strict";function n(e){return e.data.externalIds}function r(e){return t.url(c)+"/globalIds/"+(e.id||e)+"/externalIds"}function a(e){return t.url(c)+"/externalIds/"+e.type+"/"+encodeURIComponent(e.externalId)}function i(t,n,a){var i=r(t),o=_.assign(_.cloneDeep(l),a);return e.post(i,n,o)}function o(t){var n=a(t);return e.delete(n)}function u(t){var a=r(t);return e.get(a).then(n)}function s(t,n){var r=a(t);return e.get(r,n)}var c="identity",l={headers:t.contentHeaders("externalId")};return{createIdentity:i,deleteIdentity:o,listExternalIds:u,getExternalId:s}}]),function(){"use strict";function e(e,t,n,r,a,i){function o(e){var t=e&&(e.id||e);return t&&n.url(fe+"/"+t)}function u(e,t){return o(e)+"/"+t}function s(e,t,n){var r=t.id||t;return u(e,n)+"/"+r}function c(e){var t=e||{},n=["text","pageSize","currentPage","skipChildrenNames","fragmentType","withParents","q","query"];return t.text&&(t=_.pick(t,n)),t}function l(t){var r=n.url(fe),a=n.pageSizeFilter(c(t)),i={params:a},o=n.cleanListCallback("managedObjects",l,a,!0);return e.get(r,i).then(o)}function f(e,t,r){var a=n.pageSizeFilter(t);return a[r?"query":"q"]=i.buildQuery(e),l(a)}function d(n,r,a){var i=o(n),u=r||{},s=_.defaults({params:u},a);return i?e.get(i,s):t.reject("Managed object not valid")}function p(e){return d(e)}function m(e,r){function i(e,t){o(t)}function o(e){u?_.assign(u,e):u=e,_.forEach(u,function(t,n){void 0===e[n]&&delete u[n]})}var u,s,c,l=e.id||e,f=_.isObjectLike(e)?t.when(e):d(l).then(n.getResData),p="/managedobjects/"+l,m=a.realtimeActions().UPDATE;if(!r){var g={},h=c=d(l).then(function(e){return _.merge(g,e.data)}),v={ops:m,channel:p,onUpdate:function(e,t){_.merge(g,t),_.forEach(g,function(e,n){void 0===t[n]&&delete g[n]})}},y=a.watch(v);return h.stop=_.bind(y.stop,y),h}return s=r.$id,a.addListener(s,p,m,i),a.start(s,p),r.$on("stopRealtime",function(){a.stop(s,p)}),r.$on("$destroy",function(){a.stop(s,p)}),c=f.then(function(e){return o(e),u}),c}function g(t,n){var r=o(t);if(!r)throw new Error("No managed object id provided!");return e.delete(r,{params:_.isObjectLike(n)?n:{}})}function h(t){var r=n.url(fe),a=_.cloneDeep(pe),i=n.cleanFields(t,ge);return e.post(r,i,a)}function v(e,t){return E(e,t,"childAssets")}function y(e,t){return E(e,t,"childDevices")}function T(e,t){return E(e,t,"childAdditions")}function E(t,n,r){var a=u(n,r),i=_.omit(t,["id"]),o=_.assign({},pe,{Accept:"application/json"});return e.post(a,i,o)}function S(e){return h(e).then(A).then(d)}function A(e){var t=new RegExp(de);return e.headers("Location").match(t)[1]}function b(t){var r=o(t),a=_.cloneDeep(pe),i=n.cleanFields(t,ge);return ne(t),e.put(r,i,a)}function C(e){return e.id?b(e):h(e)}function I(e){return N(e,"childAssets")}function R(e){return N(e,"childDevices")}function w(e){return N(e,"childAdditions")}function N(e,t){return!!L(e,t)}function D(e){return L(e,"childAssets")}function O(e){return L(e,"childDevices")}function P(e){return L(e,"childAdditions")}function L(e,t){return _.get(e,[t,"references","length"])}function M(e,t){return x(e,"childAssets",t).then(F)}function U(e,t){return x(e,"childDevices",t).then(F)}function k(e,t){return x(e,"childAdditions",t).then(F)}function x(t,n,r){var a=u(t,n),i=r||{};return p(t).then(function(e){return e.data[n].references.length}).then(function(t){return i.params={pageSize:t},e.get(a,i)})}function F(e){return _.map(e.data.references,_.property("managedObject"))}function $(e,t){return B(e,t,"childAssets")}function G(e,t){return B(e,t,"childDevices")}function j(e,t){return B(e,t,"childAdditions")}function B(t,n,r){var a=u(t,r),i={managedObject:n},o=_.cloneDeep(me);return e.post(a,i,o)}function q(e,t,n){return H(e,"asset",t,n)}function z(e,t,n){return H(e,"device",t,n)}function V(e,t,n){return H(e,"addition",t,n)}function H(e,t,n,r){return d(e,{withParents:!0}).then(function(e){var n="data."+t+"Parents.references";return _.map(_.get(e,n),_.property("managedObject.id"))}).then(function(e){var t=[],a={ids:e.join(",")};return e.length&&(t=l(a),(n||r)&&(t=t.then(K(n,r)))),t})}function K(e,t){return function(n){return _.filter(n,function(n){return e&&n.type===e||t&&!_.isUndefined(n[t])})}}function Y(e,t,n){return Z(e,"asset",t,n)}function W(e,t,n){return Z(e,"device",t,n)}function J(e,t,n){return Z(e,"addition",t,n)}function Z(e,t,n,r){var a=_.camelCase(["child",_.lowerCase(t),"id"]),i={withParents:!0};return i[a]=e.id||e,l(i).then(function(e){return n||r?K(n,r)(e):e})}function Q(e,t){return te(e,t,"childAssets")}function X(e,t){return te(e,t,"childDevices")}function ee(e,t){return te(e,t,"childAdditions")}function te(t,n,r){var a=s(t,n,r);return e.delete(a)}function ne(e){var t=e&&e.id||e;delete ve.cache[t]}function re(e){return n.getCount(l,e||{})}function ae(t){var n=o(t)+"/supportedMeasurements";return e.get(n).then(_.property("data.c8y_SupportedMeasurements"))}function ie(t){var n=o(t)+"/supportedSeries";return e.get(n).then(_.property("data.c8y_SupportedSeries"))}function oe(e){return t.all([ae(e),ie(e)]).then(function(e){var t=_.sortBy(e[0],"length").reverse(),n=e[1];return _(n).map(function(e){var n=_.find(t,function(t){return 0===e.indexOf(t)});return{fragment:n,series:e.replace(n+".","")}}).filter(_.property("fragment")).value()})}function ue(e){var t=_.union(ge,["id","type","name","owner","self"]);return _.keys(n.cleanFields(e,t))}function se(e,n){var a={user:n?t.when(n):r.current(),owner:le(e)};return t.all(a).then(function(e){return e.user.userName===e.owner})}function ce(e,n){var a={user:n?t.when(n):r.current(),owner:he(e)};return t.all(a).then(function(e){return e.user.userName===e.owner})}function le(e){return(_.get(e,"owner")?t.when(e):d(e).then(n.getResData)).then(_.property("owner"))}var fe="inventory/managedObjects",de="\\/inventory\\/managedObjects\\/(\\d+)",pe={headers:n.contentHeaders("managedObject","managedObject")},me={headers:n.contentHeaders("managedObjectReference")},ge=["lastUpdated","assetParents","deviceParents","additionParents","childAssets","childDevices","childAdditions","c8y_ActiveAlarmsStatus","c8y_Availability"],he=_.memoize(le,function(e){return n.getId(e)}),ve=_.memoize(p,_.identity);return{list:l,listQuery:f,detail:d,detailCached:ve,detailRealtime:m,create:h,createChild:E,createConfirm:S,update:b,save:C,remove:g,hasChildAssets:I,hasChildDevices:R,hasChildAdditions:w,getChildAssetsCount:D,getChildDevicesCount:O,getChildAdditionsCount:P,childAssets:M,childDevices:U,childAdditions:k,addChildAsset:$,addChildDevice:G,addChildAddition:j,createChildAsset:v,createChildDevice:y,createChildAddition:T,removeChildAsset:Q,removeChildDevice:X,removeChildAddition:ee,parentsAsset:q,parentsDevice:z,parentsAddition:V,directParentAssets:Y,directParentDevices:W,directParentAdditions:J,getCount:re,getFragments:ue,getSupportedMeasurements:ae,getSupportedSeries:oe,isOwner:se,isOwnerCached:ce,getOwner:le,getOwnerCached:he}}e.$inject=["$http","$q","c8yBase","c8yUser","c8yRealtime","c8yQueriesUtil"],angular.module("c8y.core").factory("c8yInventory",e)}(),function(){"use strict";function e(e,t){function n(){return _.cloneDeep(l)}function r(e){return t.list(_.defaults(e,f))}function a(n){return t.detail(n).then(e.getResData)}function i(e){return _.isUndefined(e.id)?o(e):u(e)}function o(e){return t.create(_.defaults(e,l))}function u(e){return t.update(e)}function s(e){return t.remove(e)}var c="c8y_JsonSchema",l={type:c,name:"",appliesTo:{},c8y_JsonSchema:{type:"object",properties:{}}},f={type:c,pageSize:1e3};return{getDefaults:n,list:r,detail:a,create:o,update:u,save:i,remove:s}}e.$inject=["c8yBase","c8yInventory"],angular.module("c8y.core").factory("c8yJsonSchemas",e)}(),function(){"use strict";function e(e,t,n,r,a,i,o,u,s){function c(){return n.list({fragmentType:T}).then(p).then(l)}function l(e){return o.mustHaveAnyRole(["ROLE_INVENTORY_ADMIN"]).then(function(){var t=_.filter(e,function(e){return!!_.isUndefined(e.c8y_Global)}),n=_.map(t,function(e){return function(){return y(e)}});return s.run(n,"Updating KPIs...").result.then(function(t){return"complete"!==t&&u.danger("Failed to update KPIs!"),e})},_.noop)}function f(e){return c().then(function(t){return e&&e.length?_.filter(t,function(t){return e.indexOf(t.id)>-1}):t})}function d(e){var t=[T,"id","lastUpdated","creationTime","owner","self","c8y_Global","_fragments","assetParents","deviceParents","additionParents","childAssets","childDevices","childAdditions"],n=_.keys(e);return _.every(n,function(e){return t.indexOf(e)>-1})}function p(n){var r=_.filter(n,function(e){return!d(e)&&!e.c8y_Kpi_Migrated});return r.length&&t.info("Not migrated deprecated KPI found: ",r.length),e.when(_.filter(n,d))}function m(e){return n.detail(e).then(function(e){var t=e.data.c8y_Kpi;return _.forEach(E,function(e){_.isUndefined(t[e])||(t[e]=parseFloat(t[e]),isNaN(t[e])&&delete t[e])}),e})}function g(t){var r=t.id||t;return e.all([c(),n.getSupportedSeries(r)]).then(function(e){var t=e[0],n=e[1];return{matchKpi:_.filter(t,function(e){return _.find(n,{fragment:e.c8y_Kpi.fragment,series:e.c8y_Kpi.series})}),nonKpiSeries:_.filter(n,function(e){return!_.find(t,function(t){return t.c8y_Kpi.fragment===e.fragment&&t.c8y_Kpi.series===e.series})})}})}function h(e,t){var n=(t||{})[e.fragment]||{};return n.kpi=e,n.time=(t||{}).time,n.source=(t||{}).source,n}function v(e,t,n){var a=e.c8y_Kpi||e;return r.list(_.assign(i.timeOrderFilter(),{revert:!0,fragmentType:a.fragment,source:t,pageSize:n||10})).then(function(t){return _.find(t,function(t){var n=t[e.fragment];return n&&!_.isUndefined(n[e.series])})}).then(_.partial(h,a))}function y(e){var t=_.cloneDeep(e);return delete t._measurement,t.c8y_Global={},n.save(t)}var T="c8y_Kpi",E=["target","min","max","yellowRangeMin","yellowRangeMax","redRangeMin","redRangeMax"];return{list:c,listByIds:f,detail:m,remove:n.remove,save:y,listKpiForDevice:g,getMeasurement:v}}angular.module("c8y.core").factory("c8yKpi",["$q","$log","c8yInventory","c8yMeasurements","c8yUser","c8yBase","c8yPermissions","c8yAlert","c8yBatchOp",e])}(),function(){"use strict";function e(e,t,n,r,a,i){function o(e){var t=e.id||e;return r.url(C)+"/"+t}function u(e){return N().then(function(){return e&&_(D).reject("notAcceptable").map("value").includes(e.value)?e.value:"application/json"})}function s(n,a){var i,o=r.url(C),c=_.assign({},r.todayFilter({}),{pageSize:w},n),l={params:c};return a?(l.responseType="blob",i=function(e){return e.data}):i=r.cleanListCallback("measurements",s,c),u(a||D.stream).then(function(n){return l.headers={Accept:n},e.get(o,l).then(function(e){return 202===e.status?t.reject({async:!0,data:e.data}):e})}).then(i)}function c(e){var n=t.defer(),r=_.assign(e||{},{pageSize:1e3,withTotalPages:!0}),a=!1,i=function(e){var t=!_.isUndefined(e.paging.next)&&e.length>=r.pageSize;return n.notify(e),t||n.resolve(!0),!!a||(!t||e.paging.next().then(i))};return _.assign(n.promise,{cancel:function(){a=!0,n.reject("canceled")}}),s(r).then(i),n.promise}function l(t){function n(e,t){_.remove(l._cacheFilter,e),_.remove(l._cacheRequest,t)}var a=w,i=r.url(C+"/series"),o=r.todayFilter(_.assign({pageSize:a,revert:!0},t||{}));o.dateFrom&&(o.dateFrom=moment(o.dateFrom).format(r.dateFullFormat)),o.dateTo&&(o.dateTo=moment(o.dateTo).format(r.dateFullFormat));var u={params:o},s=function(e){return e.data},c=_.findIndex(l._cacheFilter,_.partial(_.isEqual,o)),f=c>=0?l._cacheRequest[c]:null;if(o.dateFrom&&(o.dateFrom=moment(o.dateFrom).format(r.dateFullFormat)),o.dateTo&&(o.dateTo=moment(o.dateTo).format(r.dateFullFormat)),!f){f=e.get(i,u).then(s);var d=_.cloneDeep(o);l._cacheFilter.push(_.cloneDeep(d)),l._cacheRequest.push(f),moment(o.dateTo).isAfter(moment())&&setTimeout(function(){n(d,f)},3e3)}return f}function f(e){var n=t.defer(),r=_.assign({revert:!0},e||{},{pageSize:1e3,withTotalPages:!0}),a=!1,i=function(e){return n.notify(e),e.paging.next||n.resolve(!0),!!a||(!e.paging.next||e.paging.next().then(i))};return _.assign(n.promise,{cancel:function(){a=!0,n.reject("canceled")}}),l(r).then(i),n.promise}function d(t){var n=o(t);return e.get(n)}function p(t){var n=r.url(C),a=t,i=_.cloneDeep(I);if(!a.source)throw new Error("c8yMeasurement: source must be defined");return e.post(n,a,i)}function m(t){var n=o(t),r=b(t),a=_.cloneDeep(I);return e.put(n,r,a)}function g(e){return e.id?m(e):p(e)}function h(t){var n=o(t);return e.delete(n)}function v(){return a.createOrDeploy(R)}function y(e,t){var n=e||{},a={};if(!n.device)throw new Error("filter.device must be defined");if(!n.fragment)throw new Error("filter.fragment must be defined");if(!n.series)throw new Error("filter.series must be defined");var o=_.assign(r.timeOrderFilter(),{revert:!0,fragmentType:n.fragment,source:n.device,pageSize:10}),u=s(o).then(function(e){return _.find(e,function(e){var t=e[n.fragment];return t&&!_.isUndefined(t[n.series])})}).then(function(e){return _.assign(a,e||{}),a});if(t){var c={ops:"CREATE",channel:"/measurements/"+n.device,onUpdate:function(e,t){var r=t[n.fragment];r&&r[n.series]&&_.assign(a,t)}},l=i.watch(c);u.stop=_.bind(l.stop,l)}return u}function T(e,a,i,o){T._cachedRequests=T._cachedRequests||[];var u=T._cachedRequests,s=e.__target.id,c=("NONE"!==o?o:0)||void 0;if(a){switch(a=moment(a),o){case"HOURLY":a.subtract(1,"hour").startOf("hour");break;case"DAILY":a.subtract(1,"day").startOf("day");break;default:a.subtract(1,"minute").startOf("minute")}a=a.format(r.dateFullFormat)}if(i){switch(i=moment(i),o){case"HOURLY":i.add(1,"hour").startOf("hour");break;case"DAILY":i.add(1,"days").startOf("day");break;default:i.add(1,"minute").startOf("minute")}i=i.format(r.dateFullFormat)}var f={dateFrom:a,dateTo:i,source:s,aggregationType:c},d=_.find(u,function(e){return _.isMatch(e.filters,f)});d||(d={deferred:t.defer(),sendDebounced:function(){return d._sendDebounced(),d.deferred.promise},_sendDebounced:_.debounce(function(){l(d.filters).then(_.unary(d.deferred.resolve))},500),filters:f},u.push(d));var p=[e.fragment,e.series].join(".");return d.filters.series=_.uniq((d.filters.series||[]).concat([p])),n(function(){return d.sendDebounced().then(E(e)).then(function(e){return e.aggregation=o,e.dateFrom=a,e.dateTo=i,e}).finally(function(){_.remove(u,d)})},5)}function E(e){return function(t){var n=_.findIndex(t.series,function(t){return t.name===e.series&&t.type===e.fragment}),r=[];return n>-1&&_.forEach(t.values,function(e,t){_.isObjectLike(e[n])&&r.push({time:t,min:Number(e[n].min),max:Number(e[n].max)})}),{dataPoint:e,values:r,truncated:t.truncated}}}function S(e){return function(t){var n=e.__target.id,r=e.fragment,a=e.series;return t.source.id===n&&t[r]&&t[r][a]&&{dataPoint:e,values:[{time:t.time,min:t[r][a].value,max:t[r][a].value}]}}}function A(){var n=r.url(C),a={params:{pageSize:1},headers:{Accept:D.stream.value},silentError:!0};return window.c8y_testing?t.when():e.get(n,a).catch(function(e){D.stream.notAcceptable=406===e.status})}var b=r.clean,C="measurement/measurements",I={headers:r.contentHeaders("measurement")},R={status:"DEPLOYED",name:"c8yui_measurements",body:'insert into SendNotification select measurement as payload, "c8yui/measurements" as channelName from MeasurementCreated;'},w=1440,N=_.once(A),D=r.createEnum([{name:"stream",value:"application/json-stream"},{name:"csv",value:"text/csv"},{name:"xlsx",value:"application/vnd.ms-excel"}]);return l._cacheFilter=[],l._cacheRequest=[],{format:D,list:s,listPaged:c,listSeries:l,listSeriesPaged:f,detail:d,create:p,update:m,save:g,remove:h,activateCep:v,latest:y,listForDataPoint:T,rtMeasurementForDatapoint:S}}angular.module("c8y.core").factory("c8yMeasurements",["$http","$q","$timeout","c8yBase","c8yCepModule","c8yRealtime",e])}(),function(){"use strict";function e(e,t,n){function r(t){var r,a;return r=n.url(o.prefix+t.outboundSMSMessageRequest.senderAddress+o.suffix),t.outboundSMSMessageRequest.receiptRequest=t.outboundSMSMessageRequest.receiptRequest||{notifyUrl:null,callbackData:null},t.outboundSMSMessageRequest.receiptRequest.notifyUrl=t.outboundSMSMessageRequest.receiptRequest.notifyUrl||null,t.outboundSMSMessageRequest.receiptRequest.callbackData=t.outboundSMSMessageRequest.receiptRequest.callbackData||null,t.outboundSMSMessageRequest.senderName=t.senderName||null,a={method:i,url:r,data:t,headers:{Accept:"application/json","Content-type":"application/json"}},e(a)}function a(e){return e.outboundSMSMessageRequest&&e.outboundSMSMessageRequest.address&&e.outboundSMSMessageRequest.senderAddress&&e.outboundSMSMessageRequest.outboundSMSTextMessage&&e.outboundSMSMessageRequest.outboundSMSTextMessage.message?r(e):t.reject("Invalid SMS data")}var i="POST",o={prefix:"service/sms/smsmessaging/v1/outbound/",suffix:"/requests"};return{sendSms:a}}angular.module("c8y.core").factory("c8yMessaging",["$http","$q","c8yBase",e])}(),function(){"use strict";function e(e,t,n,r,a,i){function o(){return n(function(){E.getTransport().abort()},C)}function u(e){var t=m(e);t.scope.$emit("connected"),t.scope.connected=!0}function s(e,t){y&&(n.cancel(),y=o()),e.$emit("message",t)}function c(e){--e.counter||(E.unsubscribe(e.comet),delete S[e.channel],_.keys(S).length||l())}function l(){y&&(n.cancel(y),y=void 0),E.removeListener(T),E.disconnect()}function f(){return E.getStatus()}function d(){b.requestHeaders=a.headers(),I.requestHeaders=a.headers()}function p(){var e=t.defer();if(E.isDisconnected()){E.handshake();var n=E.addListener("/meta/connect",function(){e.resolve(!0),E.removeListener(n)}),r=E.addListener("/meta/connect",function(e){e.failure&&401===e.failure.httpCode&&(E.disconnect(),E.removeListener(r))});T=E.addListener("/meta/subscribe",u)}else e.resolve(!0);return e.promise}function m(e){var t=_.keys(S).filter(function(t){return e.subscription.match(t)});return S[t[0]]}function g(e){return S[e]}function h(t){var n=g(t)||{},r=!1;return n.channel||(r=!0,S[t]=n,n.channel=t,n.scope=e.$new(!0),n.scope.unsubscribe=angular.bind({},c,n),n.counter=0),n.counter++,p().then(function(){return r&&(n.comet=E.subscribe(t,angular.bind({},s,n.scope)),y=o()),n.scope})}function v(e){d();var t=_.cloneDeep("debug"===e?I:b);E.configure(t)}var y,T,E=new org.cometd.CometD,S={},A=r.url("cep/customnotifications"),b={url:A,logLevel:"info",requestHeaders:a.headers(),appendMessageTypeToURL:!1},C=57e4,I=_.cloneDeep(b);return I.url=r.url("cep/notifications"),E.unregisterTransports(),r.getFlag("e2e")?C=1:E.registerTransport("long-polling",new i.LongPollingTransport),E.registerExtension("acceptEmptyMessages",{incoming:function(e){void 0===e.successful&&void 0===e.data&&(e.data={message:"The output from statement was empty"})}}),E.configure(_.cloneDeep(b)),{subscribe:h,configure:v,status:f}}e.$inject=["$rootScope","$q","$timeout","c8yBase","c8yAuth","c8yLongPollingTransport"],angular.module("c8y.core").factory("c8yNotifications",e)}(),function(){"use strict";function e(e,t,n,r,a,i,o,u){function s(e,t){var n=c(e,t);return n||(n=l(e,t)),n}function c(e,t){var n=!1;return e.roles&&e.roles.references&&_.forEach(e.roles.references,function(e){e.role.id===t&&(n=!0)}),n}function l(e,t){var n=!1;return e.groups&&e.groups.references&&_.forEach(e.groups.references,function(e){_.forEach(e.group.roles.references,function(e){e.role.id===t&&(n=!0)})}),n}function f(e,t,n,r,a){var i=d(e,t,n,r,a);return i||(i=p(e,t,n,r,a)),i}function d(e,t,n,r,a){var i=!1;return e.devicePermissions&&e.devicePermissions[t]&&(i=m(e.devicePermissions[t],n,r,a)),i}function p(e,t,n,r,a){var i=!1;return e.groups&&e.groups.references&&_.forEach(e.groups.references,function(e){e.group.devicePermissions&&e.group.devicePermissions[t]&&(i=m(e.group.devicePermissions[t],n,r,a))}),i}function m(e,t,n,r){return _.some(e,_.partial(g,t,n,r))}function g(e,t,n,r){var a=!1,i=r.split(":"),o=i[0],u=i[1],s=i[2];return h(o,e)&&h(u,t)&&h(s,n)&&(a=!0),a}function h(e,t){return"*"===e||e===t}function v(e,n){return(n?t.when(n):a.current()).then(function(t){return _.some(e,_.partial(s,t))})}function y(e,t){return U(v(e,t))}function T(e,n){return(n?t.when(n):a.current()).then(function(t){return _.every(e,_.partial(s,t))})}function E(e,t){return U(T(e,t))}function S(e,n){return t.all(_.map(_.filter(e,_.identity),_.partialRight(A,n))).then(k)}function A(e,n){var r=e.id||e,i=!n,u=function(e){return function(t){
return t||f(e,r,"MANAGED_OBJECT","*","READ")}},s=function(t){return function(n){return n||o.isOwnerCached(e,t)}},c=function(e){return e||X(r,"read")};return(i?a.current():t.when(n)).then(function(e){return v(["ROLE_INVENTORY_READ"],e).then(u(e)).then(s(e)).then(i?c:_.identity)})}function b(e){return"admin"===e?"PUT":"HEAD"}function C(e,t){var a=r.url("inventory/managedObjects/"+e),i=b(t);return n({method:i,data:"PUT"===i?{}:void 0,headers:{"content-type":"application/json",accept:void 0},silentError:!0,url:a}).then(_.constant(!0),_.constant(!1))}function I(e,t){return U(S(e,t))}function R(e,n){return t.all(_.map(_.filter(e,_.identity),_.partialRight(w,n))).then(k)}function w(e,n){var r=e.id||e,i=!n,u=function(e){return function(t){return t||f(e,r,"MANAGED_OBJECT","*","ADMIN")}},s=function(t){return function(n){return n||o.isOwnerCached(e,t)}},c=function(e){return e||X(r,"admin")};return(i?a.current():t.when(n)).then(function(e){return v(["ROLE_INVENTORY_ADMIN"],e).then(u(e)).then(s(e)).then(i?c:_.identity)})}function N(e,t){return U(R(e,t))}function D(e,n){var r=[];return e.anyRole&&r.push(v(e.anyRole,n)),e.allRoles&&r.push(T(e.allRoles,n)),e.readMOs&&r.push(S(O(e.readMOs),n)),e.adminMOs&&r.push(R(O(e.adminMOs),n)),t.all(r).then(k)}function O(e){return _.filter(_.map(e,function(e){return P(e)?L(e):e}),_.identity)}function P(e){return _.isString(e)&&/^:/.test(e)}function L(t){return e[t.replace(/^:/,"")]}function M(e,t){return U(D(e,t))}function U(e){return e.then(function(e){return e?t.when(e):t.reject(e)})}function k(e){return _.every(e,function(e){return!!e})}function x(e){var a=e.id||e,i=r.url(J+"/"+a);return _.isObjectLike(a)?t.when({groups:[],users:[]}):n.get(i).then(r.getResData).then(_.partial(F,a))}function F(e,t){var n={groups:[],users:[]};return _.forEach(t.groups,_.partial($,n,e)),_.forEach(t.users,_.partial(G,n,e)),n}function $(e,t,n){_.forEach(n.devicePermissions[t],function(t){var r=j(t),a={group:{id:n.id,name:n.name},scope:r.scope,type:r.type,access:r.access};e.groups.push(a)})}function G(e,t,n){_.forEach(n.devicePermissions[t],function(t){var r=j(t),a={username:n.userName,scope:r.scope,type:r.type,access:r.access};e.users.push(a)})}function j(e){var t=e.split(":");return{scope:t[0],type:t[1],access:t[2]}}function B(e,t){var a=e.id||e,i=r.url(J+"/"+a),o=q(a,t);return n.put(i,o)}function q(e,t){var n={groups:[],users:[]};return z(n.groups,e,t.groups),V(n.users,e,t.users),n}function z(e,t,n){var r=_.groupBy(n,function(e){return e.group.id});_.forEach(r,function(n,r){var a={id:r,devicePermissions:{}};a.devicePermissions[t]=_.map(n,function(e){return H(e)}),e.push(a)})}function V(e,t,n){var r=_.groupBy(n,function(e){return e.userName});_.forEach(r,function(n,r){var a={userName:r,devicePermissions:{}};a.devicePermissions[t]=_.map(n,function(e){return H(e)}),e.push(a)})}function H(e){return[e.scope,e.type,e.access].join(":")}function K(){return["READ","ADMIN","*"]}function Y(){return i.listRoles().then(W)}function W(e){return _.map(e,function(e){var t=e.id.match(/ROLE_(.+)_(\w+$)/),n=t[1],r=t[2];return{id:e.id,category:n,access:r}})}var J="user/devicePermissions",Z=r.createEnum([{name:"ALARM",value:"ALARM",label:u("Alarms")},{name:"AUDIT",value:"AUDIT",label:u("Audits")},{name:"EVENT",value:"EVENT",label:u("Events")},{name:"MANAGED_OBJECT",value:"MANAGED_OBJECT",label:u("Inventory")},{name:"MEASUREMENT",value:"MEASUREMENT",label:u("Measurements")},{name:"OPERATION",value:"OPERATION",label:u("Device control")},{name:"SUPPORT",value:"SUPPORT",label:u("Support")},{name:"ALL",value:"*",label:u("Full access")}]),Q=r.createEnum([{name:"READ",value:"READ",label:u("Read")},{name:"CHANGE",value:"ADMIN",label:u("Change")},{name:"ALL",value:"*",label:u("All")}]),X=_.memoize(C,function(e,t){return e+b(t)});return{hasRole:s,hasDevicePermission:f,hasAnyRole:v,mustHaveAnyRole:y,hasAllRoles:T,mustHaveAllRoles:E,canReadMOs:S,mustHaveReadMOs:I,canAdminMOs:R,mustHaveAdminMOs:N,isAllowed:D,mustBeAllowed:M,getMOPermissions:x,setMOPermissions:B,getAccessTypes:K,listGlobal:Y,SCOPES:Z,ACCESS_TYPES:Q}}e.$inject=["$routeParams","$q","$http","c8yBase","c8yUser","c8yUserGroup","c8yInventory","gettext"],angular.module("c8y.core").factory("c8yPermissions",e)}(),function(){"use strict";angular.module("c8y.core").config(["$provide",function(e){e.decorator("$q",["$delegate",function(e){function t(e){return _.reduce(e,function(e,t,n){return e[n]=void 0,e},{})}return e.some=function(n,r){var a,i,o=e.defer(),u=0,s=0,c=_.size(n);return _.isArray(n)?(a=[],i=[]):(a=t(n),i=t(n)),0===r?(o.resolve(_.clone(a)),o.promise):(_.forEach(n,function(e,t){e.then(function(e){u++,a[t]=e,o.notify({key:t,result:e}),u===r&&o.resolve(_.clone(a))},function(e){s++,i[t]=e,o.notify({key:t,reason:e}),s===c&&o.reject(_.clone(i))})}),o.promise)},e.any=function(t){return e.some(t,1).then(function(e){return _.filter(e,_.identity)[0]})},e}])}])}(),function(){"use strict";function e(e,t){function n(e,t){return e.length>1?["(",e.join(") "+t+" ("),")"].join(""):e[0]}function r(e){return _.isString(e)?["'",e,"'"].join(""):e}function a(e){var t=[],n=i(e.__filter||e),r=o(e.__orderby);return _.isEmpty(n)||t.push(["$filter=(",n,")"].join("")),_.isEmpty(r)||t.push(["$orderby=",r].join("")),t.join(" ")}function i(e,t,r){t=t||null,r=r||"and";var a=[];return _.isArray(e)?_.forEach(e,function(e){var t=i(e,null,r);_.isEmpty(t)||a.push(t)}):_.forEach(e,function(e,n){if(_.isUndefined(u[n])){var r=u.__eq(e,n);_.isEmpty(r)||a.push(r)}else{var r=u[n](e,t);_.isEmpty(r)||a.push(r)}}),n(a,r)}function o(e){var t=[];return _.forEach(e,function(e){_.forEach(e,function(e,n){0!==e&&t.push([n,e>0?"asc":"desc"].join(" "))})}),t.join(",")}var u={__not:function(e){return["not(",i(e,null),")"].join("")},__and:function(e){return i(e,null,"and")},__or:function(e){return i(e,null,"or")},__eq:function(e,t){return _.isObjectLike(e)?i(e,t):[t,"eq",r(e)].join(" ")},__gt:function(e,t){return[t,"gt",r(e)].join(" ")},__lt:function(e,t){return[t,"lt",r(e)].join(" ")},__in:function(e,t){return n(_.map(_.filter(e,_.identity),function(e){return[t,"eq",r(e)].join(" ")}),"or")},__bygroupid:function(e){return["bygroupid(",e,")"].join("")},__has:function(e){return["has(",e,")"].join("")}};return{buildQuery:a,buildQueryFilter:i,buildQueryOrderby:o}}angular.module("c8y.core").factory("c8yQueriesUtil",["$rootScope","$injector",e])}(),function(){"use strict";function e(e,t,n,r,a){function i(){O.configure({url:n.url("cep/realtime"),logLevel:"info",requestHeaders:r.headers(),appendMessageTypeToURL:!1}),n.getFlag("e2e")&&O.registerExtension(D.getName(),D)}function o(){P=e.defer(),O.disconnect()}function u(e,t,n,r){var a=_.find(M,{name:t});a||(a=s(t),M.push(a));var i=a.subscribers,o=_.find(i,{id:e});o||(o=c(e),i.push(o));var u=o.subscribedEvents,l=_.find(u,{name:n});l||(l=f(n),u.push(l)),l.listeners.push(r)}function s(e){return{name:e,subscription:void 0,subscribers:[]}}function c(e){return{id:e,subscribedEvents:_.map(l(),f),active:!1}}function l(){return{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE"}}function f(e){return{name:e,listeners:[]}}function d(e,t){p(e,t)?m(e,t):g(e,t)}function p(e,t){var n=b(t);return _.every(n,function(t){var n=!1,r=_.find(M,{name:t});return r&&(n=Boolean(_.find(r.subscribers,{id:e,active:!0}))),n})}function m(e,t){var n=T(e,t);n&&(n.active=!1)}function g(e,t){var n=T(e,t);if(n){n.active=!0;var r=_.find(M,{name:t});if(_.isUndefined(r.subscription))return h(r)}}function h(e){v().then(function(){e.subscription=O.subscribe(e.name,function(t){var n=t.data,r=n.realtimeAction,a=n.data;_(e.subscribers).filter("active").forEach(function(e){var t=_.find(e.subscribedEvents,{name:r}),n=t.listeners;_.forEach(n,function(e){e(r,a)})})})})}function v(){return P.promise}function y(e,t){if(T(e,t)){var n=_.find(M,{name:t}),r=n.subscribers;_.remove(r,{id:e}),_.isEmpty(r)&&E(n)}}function T(e,t){var n=_.find(M,{name:t});if(!n)throw new Error('There is no listener registered for your scope on the channel "'+t+'"');return _.find(n.subscribers,{id:e})}function E(e){var t=e.subscription;t&&O.unsubscribe(t),_.remove(M,e)}function S(e,t){y(e,t)}function A(e){var t=_.drop(arguments),n=t[1],r=b(n);_.forEach(r,function(n){t[1]=n,e.apply(this,t)}.bind(this))}function b(e){var t=[],n=e.match(/(\/.*)\/(.*)$/);if(_.isEmpty(n))t.push(e);else{var r=n[1],a=n[2].split(",");_.forEach(a,function(e){t.push(r+"/"+e)})}return t}function C(e){return e?"check-circle-o":"circle-o"}function I(e){var t=e.id||String(Math.random()).substr(2),n=e.channel,r=_.flattenDeep([e.ops||_.values(l())]),a=e.onUpdate||_.noop;return _.forEach(r,function(e){u(t,n,e,a)}),g(t,n),{stop:function(){m(t,n)}}}function R(){return n.getFlag("test")||console.warn("DO NOT USE THIS API CALL: it will break encapsulation, use it only for doing state verification in unit test."),M}function w(){return O.getStatus()}if(n.getFlag("e2e"))var N=function(){function e(e){return _.toNumber(e)||(0===_.toNumber(e)?0:2e3)}function t(e){return _.toNumber(e)||(0===_.toNumber(e)?0:1e3)}this.registered=function(){},this.outgoing=function(r){r.advice={reconnect:"retry",interval:e(n.getRuntimeOption("realtimeInterval")),timeout:t(n.getRuntimeOption("realtimeTimeout"))}},this.getName=function(){return"e2eExtension"}},D=new N;var O=new org.cometd.CometD;O.unregisterTransports(),O.registerTransport("long-polling",new a.LongPollingTransport),O.websocketEnabled=!1;var P=e.defer();O.addListener("/meta/handshake",function(e){if(!e.successful){var t=new Error("Handshake failed.");throw P.reject(t),t}_.forEach(M,function(e){var t=e.subscription;t&&O.resubscribe(t)}),P.resolve()});var L=O.addListener("/meta/connect",function(e){e.failure&&401===e.failure.httpCode&&(o(),O.removeListener(L))});t.$on("authStateChange",function(e,t){t.hasAuth?(i(),O.handshake()):o()}),O.onListenerException=function(e,t,r){throw r?this.removeListener(t):this.unsubscribe(t),n.getFlag("e2e")&&O.unregisterExtension(D.getName()),new Error("Something went wrong: "+e)};var M=[];return{addListener:_.wrap(u,A),realtimeActions:l,switchRealtime:_.wrap(d,A),getStatus:p,start:_.wrap(g,A),stop:_.wrap(m,A),removeSubscriber:_.wrap(y,A),destroySubscription:_.wrap(S,A),icon:C,watch:I,_getSubscriptionChannels:R,status:w}}angular.module("c8y.core").factory("c8yRealtime",e),e.$inject=["$q","$rootScope","c8yBase","c8yAuth","c8yLongPollingTransport"]}(),function(){function e(e,t){function n(){var e=new org.cometd.LongPollingTransport,t=org.cometd.Transport.derive(e);return t.xhrSend=function(e){return i(e)},t}function r(t){var n={},r=t.headers||{};return r["Content-Type"]="application/json;charset=UTF-8",o.disabled||e.post(t.url,t.body,{headers:r,withCredentials:!0}).success(function(e,r){n.status=r,t.onSuccess(e)}).error(function(e,r,a,i,o){n.status=r,t.onError(o)}),n}function a(e){var t=JSON.parse(e.body);return setTimeout(function(){e.onSuccess({successful:!0,id:t.id,channel:t.channel},100)}),{status:200}}var i=r,o={LongPollingTransport:n,enable:function(e){i=e?r:a}};return o.enable(!t.getFlag("test")),o}e.$inject=["$http","c8yBase"],angular.module("c8y.core").factory("c8yLongPollingTransport",e),_.assign(org.cometd.JSON,{toJSON:JSON.stringify,fromJSON:JSON.parse})}(),function(){function e(e,t,n){function r(a){var i=n.url(f);a=n.pageSizeFilter(a);var o={params:a,silentError:!0},u=n.cleanListCallback("retentionRules",r,a);return e.get(i,o).then(u,t.reject)}function a(n){var r=c(n);return r?e.get(r):t.reject("Retention rule object is not valid")}function i(t){var r=n.url(f);return e.post(r,t,d)}function o(t){var n=c(t);return e.put(n,t,d)}function u(e){return e.id?o(e):i(e)}function s(n){var r=c(n);return r?e.delete(r):t.reject("Retention rule object is not valid")}function c(e){var t=e&&e.id||e;if(t)return n.url(f+"/"+t)}function l(e,t){return!_.includes(p[e.dataType||"*"]||[],t)}var f="retention/retentions",d={headers:n.contentHeaders("retentionRule","retentionRule")},p={ALARM:["fragmentType"],EVENT:[],MEASUREMENT:[],OPERATION:["type"],AUDIT:["fragmentType"],"*":[]};return{list:r,detail:a,create:i,update:o,save:u,remove:s,dataTypes:["ALARM","EVENT","MEASUREMENT","OPERATION","AUDIT","*"],isFieldSupportedByRule:l}}angular.module("c8y.core").factory("c8yRetentions",["$http","$q","c8yBase",e])}(),function(){"use strict";function e(e,t,n,r){function a(){return n.url(m)}function i(e){var t=n.getId(e);return n.url(m+"/"+t)}function o(e){var r=n.pageSizeFilter(e),i={params:r},u=n.cleanListCallback("roles",o,r);return t.get(a(),i).then(u)}function u(e){var n=i(e);return t.get(n)}function s(e){var n=i(e);return t.delete(n,{silentError:!0})}function c(e){var n=i(e),r={headers:g};return t.put(n,e,r)}function l(e){var n=a(),r={headers:g};return delete e.id,t.post(n,e,r)}function f(e){return e.id?c(e):l(e)}function d(e){var t=!1;return e&&e.self&&(t=p.test(e.self)),t}var p=/groups\/\d+$/,m="user/inventoryroles",g={"Content-Type":"application/json",Accept:"application/json"};return{list:o,detail:u,remove:s,create:l,update:c,save:f,global:r,isGlobal:d}}e.$inject=["$q","$http","c8yBase","c8yUserGroup"],angular.module("c8y.core").factory("c8yRoles",e)}(),function(){"use strict";function e(e,t,n){function r(e){return t.url(v+"/"+e.category+(e.key?"/"+e.key:""))}function a(e){return t.url(y+"/"+e.category+(e.key?"/"+e.key:""))}function i(e){return t.url(T+"/"+e.category+(e.key?"/"+e.key:""))}function o(n){var r=t.url(v),a=t.pageSizeFilter(n),i={params:a},u=t.cleanListCallback("options",o,a),s=e.get(r,i).then(u);return n&&n.category&&(s=s.then(function(e){var t=e.filter(function(e){return e.category===n.category});return t.paging=e.paging,t})),s}function u(t){var n=r(t),a=_.cloneDeep(t),i=_.cloneDeep(E);return e.put(n,a,i)}function s(n){var r=t.url(v),a=_.cloneDeep(n),i=_.cloneDeep(E);return e.post(r,a,i)}function c(t){var n=r(t);return e.delete(n)}function l(t,n){var i="password"===t.category?a(t):r(t),o=_.merge({silentError:!0},n);return e.get(i,o)}function f(e,t,n){return t=!_.isUndefined(t)&&t,l(e,n).then(_.partialRight(m,t),_.partial(_.identity,t))}function d(t,n){var r=i(t),a=_.merge({silentError:!0},n);return e.get(r,a)}function p(e,t,n){return t=!_.isUndefined(t)&&t,d(e,n).then(_.partialRight(m,t),_.partial(_.identity,t))}function m(e,t){return g(_.get(e,"data.value"),t)}function g(e,t){var n;try{n=JSON.parse(e)}catch(r){n=_.isUndefined(e)?t:e}return n}function h(e,t){var e=e||8,t=t||32;Object.defineProperty(window.c8yConfig.validation.password,"message",{get:function(){return n.getString("Password must have at least {{min}} characters and no more than {{max}} and can only contain letters, numbers and following symbols: `~!@#$%^&*()_|+-=?;:'\",.<>{}[]\\/",{min:e,max:t})}}),Object.defineProperty(window.c8yConfig.validation.password,"pattern",{get:function(){var n=e+"_"+t;return S[n]||(S[n]=new RegExp("^[a-zA-Z0-9`~!@#$%^&*()_|+\\-=?;:'\",.<>\\{\\}\\[\\]\\\\/]{"+e+","+t+"}$")),S[n]}})}var v="tenant/options",y="tenant/security-options",T="tenant/system/options",E={headers:t.contentHeaders("option")},S={};return{list:o,detail:l,detailValue:f,updateOption:u,createOption:s,deleteOption:c,getSystemOption:d,getSystemOptionValue:p,parseOptionRawValue:g,setUserPasswordValidationParams:h}}e.$inject=["$http","c8yBase","gettextCatalog"],angular.module("c8y.core").factory("c8ySettings",e)}(),angular.module("c8y.core").factory("c8ySimulator",["$http","c8yBase","gettext",function(e,t,n){"use strict";function r(){var n=t.url(l);return e.get(n,{params:{pageSize:2e3}}).then(t.getResData)}function a(n,r){var a=n.id||n,i=t.url(l+"/"+a),o={state:r},u=_.cloneDeep(d);return e.put(i,o,u)}function i(n){var r=n.id||n,a=t.url(l+"/"+r),i=_.cloneDeep(d);return e.delete(a,i)}function o(){var n=t.url(f);return e.get(n).then(t.getResData)}function u(n){var r=t.url(c),a=_.cloneDeep(n),i=_.cloneDeep(p);return e.post(r,a,i)}function s(n){var r=t.url(l),a=_.cloneDeep(n),i=_.cloneDeep(d);return e.post(r,a,i)}var c="simulator/templates",l="simulator/configurations",f=c+"/sensors",d={headers:t.contentHeaders("simulator","simulator")},p={headers:t.contentHeaders("template","template")};return{list:r,changeState:a,deleteSimulator:i,createSimulator:s,createTemplate:u,getSensors:o,STATES:{NEW:n("NEW"),RUNNING:n("RUNNING"),PAUSED:n("PAUSED")}}}]),function(){"use strict";function e(e,t,n,r,a,i){function o(){return _.defaults({},X)}function u(e,t){return c(_.defaults({},e,X)).then(function(e){return s(e,t).then(_.partial(_.identity,e)).then(B)})}function s(e,t){var n={type:K,externalId:t};return r.createIdentity(e,n)}function c(e){return n.save(q(e)).then(t.getResData).then(B)}function l(){return n.list({type:V,pageSize:Y}).then(function(t){return e.all(_.map(t,B))})}function f(e){return n.detail(e).then(t.getResData).then(B)}function d(e){return r.listExternalIds(e).then(function(e){var t=_.find(e,{type:K});return t&&t.externalId})}function p(e){return n.remove(e)}function m(e){var t=e.name+".json",n=JSON.stringify(g(e),null,2),r=new Blob([n],{type:"application/json"});saveAs(r,t)}function g(e){return _(q(e)).pick(["name","type",H]).assign(_.pick(e,["__externalId"])).value()}function h(e){return e[H].requestTemplates.length}function v(e){return _.map(_.flatten([e[H].requestTemplates,e[H].responseTemplates]),"msgId")}function y(){return _.defaults({},ee)}function T(e,t){var n=_.defaults({},t,ee);return e[H].requestTemplates.push(n),n}function E(e,t){_.pull(e[H].requestTemplates,t)}function S(e){if(e.api&&e.method){var t=ae[e.api][e.method]||[];e.mandatoryValues=_.map(t,function(t){var n=(_.find(e.mandatoryValues,{path:t.path,type:t.type})||{}).value;return _.assign({},t,{value:n})}),e.response=e.method===J.GET.name}}function A(e){var t=e.api===W.INVENTORY.name,n=e.method===J.GET.name,r=e.method===J.PUT.name;return t&&(n||r)}function b(e,t){var n=_.defaults({},t,te);return e.customValues.push(n),n}function C(e,t){_.pull(e.customValues,t)}function I(e){return e[H].responseTemplates.length}function R(){return _.defaults({},ne)}function w(e,t){var n=_.defaults({},t,ne);return e[H].responseTemplates.push(n),n}function N(e,t){_.pull(e[H].responseTemplates,t)}function D(e,t){var n=_.defaults({},t,re);return e.patterns.push(n),n}function O(e,t){_.pull(e.patterns,t)}function P(e){var t=_.keys(ae[e]||{});return _.filter(J.values(),function(e){return _.includes(t,e.name)})}function L(e,t){t=t||{};var n=[],r=M(e);return t.skipRequestTemplates||(n.push([i.getString("Messages")]),n.push([i.getString("Name"),i.getString("API"),i.getString("Method"),i.getString("Preview")]),_.each(r.requestTemplates,function(e){n.push([e.name,e.api,e.method,e.csv])})),t.skipRequestTemplates||t.skipResponseTemplates||n.push([]),t.skipResponseTemplates||(n.push([i.getString("Responses")]),n.push([i.getString("Name"),i.getString("Preview")]),_.each(r.responseTemplates,function(e){n.push([e.name,e.csv])})),n}function M(e){return{requestTemplates:_.map(e[H].requestTemplates,F),responseTemplates:_.map(e[H].responseTemplates,$)}}function U(){return l().then(k).then(function(e){return _.union(e,_.cloneDeep(ie))})}function k(e){return _(e).reduce(x,[])}function x(e,t){var n=t[H],r=n.requestTemplates;return _.forEach(r,function(n){Object.defineProperties(n,{_template:{value:t}}),e.push(n)}),e}function F(e){return{name:e.name,api:e.api,method:e.method,csv:G(e)}}function $(e){return{name:e.name,csv:j(e)}}function G(e){return _.compact(_.flatten([e.msgId,e.api===W.INVENTORY.name&&e.method===J.GET.name?e.byId?"<deviceId>":e.externalIdType?"<externalId>":"<externalIdType>,<externalId>":void 0,_.map(e.mandatoryValues||[],function(e){if(e.type!==Z.FLAG.name&&!e.value)return["<",e.path,">"].join("")}),_.map(e.customValues||[],function(e){if(e.type!==Z.FLAG.name&&!e.value)return["<",e.path,">"].join("")})])).join(",")}function j(e){return _.compact(_.flatten([e.msgId,_.map(e.patterns||[],function(e){return["<",e.path,">"].join("")})])).join(",")}function B(e){return d(e).then(function(t){var n=_.cloneDeep(e);return n.__externalId=t,_.forEach(n[H].responseTemplates,function(e){e.pattern&&(e.patterns=_.map(e.pattern,function(e){return{path:e}}),delete e.pattern)}),n})}function q(e){var t=_.cloneDeep(e);return t.__externalId=void 0,_.forEach((t[H]||{}).responseTemplates,function(e){e.patterns&&(e.pattern=_.map(e.patterns,function(e){return e.path}),delete e.patterns)}),t}function z(){return _.filter(Z.values(),function(e){return-1===Q.indexOf(e.value)})}var V="c8y_SmartRest2Template",H="com_cumulocity_model_smartrest_csv_CsvSmartRestTemplate",K="c8y_SmartRest2DeviceIdentifier",Y=1e3,W=t.createEnum(["INVENTORY","MEASUREMENT","ALARM","EVENT","OPERATION"]),J=t.createEnum(["GET","PUT","POST"]),Z=t.createEnum([{name:"STRING",value:"STRING",label:a("STRING")},{name:"DATE",value:"DATE",label:a("DATE")},{name:"NUMBER",value:"NUMBER",label:a("NUMBER"),numeric:!0},{name:"INTEGER",value:"INTEGER",label:a("INTEGER"),numeric:!0},{name:"UNSIGNED",value:"UNSIGNED",label:a("UNSIGNED"),numeric:!0},{name:"FLAG",value:"FLAG",label:a("FLAG")},{name:"SEVERITY",value:"SEVERITY",label:a("SEVERITY")},{name:"ALARMSTATUS",value:"ALARMSTATUS",label:a("ALARM STATUS")},{name:"OPERATIONSTATUS",value:"OPERATIONSTATUS",label:a("OPERATION STATUS")},{name:"ARRAY",value:"ARRAY",label:a("ARRAY")},{name:"OBJECTARRAY",value:"OBJECTARRAY",label:a("OBJECT ARRAY")}]),Q=[Z.OBJECTARRAY.value,Z.ARRAY.value],X={name:"",type:V,com_cumulocity_model_smartrest_csv_CsvSmartRestTemplate:{requestTemplates:[],responseTemplates:[]}},ee={name:"",msgId:"",api:W.INVENTORY.name,method:J.GET.name,response:!0,byId:!0,mandatoryValues:[],customValues:[]},te={path:"",type:Z.STRING.name,value:""},ne={name:"",msgId:"",base:"",condition:"",patterns:[]},re={path:""},ae={MEASUREMENT:{POST:[{path:"$.type",type:Z.STRING.name},{path:"$.time",type:Z.DATE.name}]},EVENT:{POST:[{path:"$.type",type:Z.STRING.name},{path:"$.text",type:Z.STRING.name},{path:"$.time",type:Z.DATE.name}]},ALARM:{POST:[{path:"$.type",type:Z.STRING.name},{path:"$.text",type:Z.STRING.name},{path:"$.status",type:Z.ALARMSTATUS.name},{path:"$.severity",type:Z.SEVERITY.name},{path:"$.time",type:Z.DATE.name}],PUT:[{path:"$.type",type:Z.STRING.name}]},OPERATION:{PUT:[{path:"$.type",type:Z.STRING.name}]},INVENTORY:{POST:[{path:"$.type",type:Z.STRING.name}],PUT:[],GET:[]}},ie=[{msgId:"100",name:a("Device creation"),values:[{label:a("device name"),type:Z.STRING.name,default:"MQTT Device <serialNumber>"},{label:a("device type"),type:Z.STRING.name,default:"c8y_MQTTDevice"}],hideInSimulators:!0},{msgId:"101",name:a("Child device creation"),values:[{label:a("unique child ID"),type:Z.STRING.name,mandatory:!0},{label:a("device name"),type:Z.STRING.name,default:"MQTT Device <serialNumber>"},{label:a("device type"),type:Z.STRING.name,default:"c8y_MQTTChildDevice"}],hideInSimulators:!0},{msgId:"105",name:a("Get child device"),hideInSimulators:!0},{msgId:"110",name:a("Configure hardware"),values:[{label:a("serialNumber"),type:Z.STRING.name},{label:a("model"),type:Z.STRING.name},{label:a("revision"),type:Z.STRING.name}]},{msgId:"111",name:a("Configure mobile"),values:[{label:a("imei"),type:Z.STRING.name},{label:a("iccid"),type:Z.STRING.name},{label:a("imsi"),type:Z.STRING.name},{label:a("mcc"),type:Z.STRING.name},{label:a("mnc"),type:Z.STRING.name},{label:a("lac"),type:Z.STRING.name},{label:a("cellId"),type:Z.STRING.name}]},{msgId:"112",name:a("Configure position"),values:[{label:a("latitude"),type:Z.STRING.name},{label:a("longitude"),type:Z.STRING.name},{label:a("altitude"),type:Z.STRING.name},{label:a("accuracy"),type:Z.STRING.name}]},{msgId:"113",name:a("Set configuration"),values:[{label:a("configuration"),type:Z.STRING.name}]},{msgId:"114",name:a("Set supported operations"),values:[{label:a("List of supported operations"),type:Z.ARRAY.name}],hideInSimulators:!0},{msgId:"115",name:a("Set firmware"),values:[{label:a("name"),type:Z.STRING.name},{label:a("version"),type:Z.STRING.name},{label:a("url"),type:Z.STRING.name}]},{msgId:"116",name:a("Set software list"),values:[{label:a("List of 3 values per software"),type:Z.OBJECTARRAY.name,values:[{label:a("name"),type:Z.STRING.name},{label:a("version"),type:Z.STRING.name},{label:a("url"),type:Z.STRING.name}]}]},{msgId:"117",name:a("Set required availability"),values:[{label:a("required interval"),type:Z.NUMBER.name}]},{msgId:"200",name:a("Create custom measurement"),values:[{label:a("fragment"),type:Z.STRING.name,mandatory:!0},{label:a("series"),type:Z.STRING.name,mandatory:!0},{label:a("value"),type:Z.NUMBER.name,mandatory:!0},{label:a("unit"),type:Z.STRING.name},{label:a("time"),type:Z.DATE.name}]},{msgId:"210",name:a("Create signal strength measurement"),values:[{label:a("rssi value"),type:Z.NUMBER.name,mandatory:!0},{label:a("ber value"),type:Z.NUMBER.name,mandatory:!0},{label:a("time"),type:Z.DATE.name}]},{msgId:"211",name:a("Create temperature measurement"),values:[{label:a("temperature value"),type:Z.NUMBER.name,mandatory:!0},{label:a("time"),type:Z.DATE.name}]},{msgId:"212",name:a("Create battery measurement"),values:[{label:a("battery value"),type:Z.NUMBER.name,mandatory:!0},{label:a("time"),type:Z.DATE.name}]},{msgId:"301",name:a("Create CRITICAL alarm"),values:[{label:a("type"),type:Z.STRING.name,mandatory:!0},{label:a("text"),type:Z.STRING.name,default:"Alarm of type <alarmType> raised"},{label:a("time"),type:Z.DATE.name}]},{msgId:"302",name:a("Create MAJOR alarm"),values:[{label:a("type"),type:Z.STRING.name,mandatory:!0},{label:a("text"),type:Z.STRING.name,default:"Alarm of type <alarmType> raised"},{label:a("time"),type:Z.DATE.name}]},{msgId:"303",name:a("Create MINOR alarm"),values:[{label:a("type"),type:Z.STRING.name,mandatory:!0},{label:a("text"),type:Z.STRING.name,default:"Alarm of type <alarmType> raised"},{label:a("time"),type:Z.DATE.name}]},{msgId:"304",name:a("Create WARNING alarm"),values:[{label:a("type"),type:Z.STRING.name,mandatory:!0},{label:a("text"),type:Z.STRING.name,default:"Alarm of type <alarmType> raised"},{label:a("time"),type:Z.DATE.name}]},{msgId:"305",name:a("Update severity of existing alarm"),values:[{label:a("type"),type:Z.STRING.name,mandatory:!0},{label:a("severity"),type:Z.SEVERITY.name,mandatory:!0}]},{msgId:"306",name:a("Clear existing alarm"),values:[{label:a("type"),type:Z.STRING.name,mandatory:!0},{label:a("severity"),type:Z.SEVERITY.name,mandatory:!0}]},{msgId:"400",name:a("Create basic event"),values:[{label:a("type"),type:Z.STRING.name,mandatory:!0},{label:a("text"),type:Z.STRING.name,mandatory:!0},{label:a("time"),type:Z.DATE.name}]},{msgId:"401",name:a("Create location update event"),values:[{label:a("latitude"),type:Z.STRING.name},{label:a("longitude"),type:Z.STRING.name},{label:a("altitude"),type:Z.STRING.name},{label:a("accuracy"),type:Z.STRING.name}]},{msgId:"402",name:a("Create location update event with device update"),values:[{label:a("latitude"),type:Z.STRING.name},{label:a("longitude"),type:Z.STRING.name},{label:a("altitude"),type:Z.STRING.name},{label:a("accuracy"),type:Z.STRING.name}]},{msgId:"500",name:a("Get PENDING operations"),hideInSimulators:!0},{msgId:"501",name:a("Set operation to EXECUTING"),values:[{label:a("fragment"),type:Z.STRING.name,mandatory:!0}],hideInSimulators:!0},{msgId:"502",name:a("Set operation to FAILED"),values:[{label:a("fragment"),type:Z.STRING.name,mandatory:!0},{label:a("failureReason"),type:Z.STRING.name}],hideInSimulators:!0},{msgId:"503",name:a("Set operation to SUCCESSFUL"),values:[{label:a("fragment"),type:Z.STRING.name,mandatory:!0},{label:a("parameters"),type:Z.ARRAY.name}],hideInSimulators:!0}];return{APIs:W,Methods:J,Types:Z,fragmentType:H,externalIdType:K,newTemplate:o,create:u,save:c,list:l,detail:f,remove:p,download:m,getAllMsgIds:v,countRequestTemplates:h,newRequestTemplate:y,addRequestTemplate:T,removeRequestTemplate:E,setupRequestTemplateDefaults:S,doesRequestTemplateRequireByIdOrByExternalId:A,addRequestTemplateCustomValue:b,removeRequestTemplateCustomValue:C,getRequestTemplatePreview:F,countResponseTemplates:I,newResponseTemplate:R,addResponseTemplate:w,removeResponseTemplate:N,addResponseTemplatePattern:D,removeResponseTemplatePattern:O,getResponseTemplatePreview:$,getPreviewsCsvData:L,getPreviews:M,getMethodsForAPI:P,listAllPublishMessages:U,typesForUI:z}}e.$inject=["$q","c8yBase","c8yInventory","c8yIdentity","gettext","gettextCatalog"],angular.module("c8y.core").factory("c8ySmartRestTemplates",e)}(),angular.module("c8y.core").factory("c8yStatement",["$http","$q","$timeout","c8yBase",function(e,t,n,r){"use strict";function a(e){return e=_.cloneDeep(e),delete e.id,delete e.module,e}function i(e){return"default"===e.name}function o(e){return _.isObjectLike(e)?e.id:e}function u(e){return r.url(f+"/"+c.id+"/statements"+(e?"/"+o(e):""))}function s(n){return function(a){var o,u,s=t.defer();return s.promise.then(function(){n(a).success(o).error(u)}),c?s.resolve():e.get(r.url(f)).success(function(t){for(var n in t.modules){var a=t.modules[n];if(i(a))return c=a,void s.resolve()}e.post(r.url(f),{name:"default"},d()).success(function(e){c=e,s.resolve()})}),{then:function(e,t){o=e,u=t},success:function(e){return o=e,this},error:function(e){return u=e,this}}}}var c,l={},f="cep/modules",d=function(){return r.requestConfig("cepModule","cepModule")},p=function(){return r.requestConfig("cepStatement","cepStatement")},m=[{name:"select temperate readings over 100 degree",value:'select * from MeasurementCreated e\nwhere getNumber(e, "c8y_TemperatureMeasurement.T.value") > 100'},{name:"create alarm when temperature over 100 degree",value:'insert into CreateAlarm \n  select\n    e.measurement.time as time,\n    e.measurement.source.value as source,\n    "com_cumulocity_TemperatureAlert" as type,\n    "Temperature too high" as text,\n    "ACTIVE" as status,\n    "CRITICAL" as severity\n  from MeasurementCreated e\n  where getNumber(e, "c8y_TemperatureMeasurement.T.value") > 100'},{name:"create alarm when temperature below 0 degree",value:'insert into CreateAlarm \n  select\n    e.measurement.time as time,\n    e.measurement.source.value as source,\n    "com_cumulocity_TemperatureAlert" as type,\n    "Temperature too low" as text,\n    "ACTIVE" as status,\n    "CRITICAL" as severity\n  from MeasurementCreated e\n  where getNumber(e, "c8y_TemperatureMeasurement.T.value") > 100'},{name:"create close replay operation when temperature readings over 100 degree",value:'insert into CreateOperation\n  select\n    "PENDING" as status,\n    «heating ID» as deviceId\n    {\n      "c8y_Relay.relayState", "CLOSED"\n    } as fragments\n  from MeasurementCreated e\n  where getNumber(e, "c8y_TemperatureMeasurement.T.value") > 100'},{name:"select location change event once for 60 seconds",value:'select * from EventCreated e\nwhere getObject(e, "c8y_LocationMeasurement") is not null\noutput first every 60 seconds'},{name:"send email notification with current temperature",value:'expression string js:prepareEmailText(temp, state) [\n    function format(text, params){\n            for(param in params) {\n                text = text.replace("{" + param + "}", params[param])\n            }\n        return text\n    }\n    format("Hello,\\n current temperature is {0} (state = {1}). Regards.", [temp, state])\n]\ninsert into SendEmail\nselect\n  "sender@sender" as sender,\n  "receiver@receiver" as receiver,\n  "Temperature critical!" as subject,\n  prepareEmailText(\n    getNumber(e, "c8y_TemperatureMeasurement.T.value"),\n    getString(e, "c8y_TemperatureMeasurement.T.state")\n   ) as text\nfrom MeasurementCreated e'},{name:"change the severities of alarms based on activity time",
value:'/* Create "context" - definition of a group of events to be processed separately.\n * Context "Alarms" consists of AlarmCreated and AlarmUpdated: \n * with the same source and type = "power off". */\ncreate context Alarms partition by \nalarm.source from AlarmCreated(alarm.type = "power off"),\nalarm.source from AlarmUpdated(alarm.type = "power off");\n\n/* Update severity for all active AlarmCreated \n * after which there is no change to other status in 15 minutes. */\ncontext Alarms \ninsert into UpdateAlarm \nselect \n   a.alarm.id as id,\n   "MAJOR" as severity\nfrom pattern [\n   every a = AlarmCreated(alarm.status = CumulocityAlarmStatuses.ACTIVE) \n   -> (timer:interval(15 minutes) \n      and not AlarmUpdated(alarm.status != CumulocityAlarmStatuses.ACTIVE))\n];'}];return l.list=s(function(t){return e.get(r.url(f+"/"+c.id+"/statements"),t)}),l.detail=s(function(t){return e.get(u(t))}),l.remove=s(function(t){return e.delete(u(t.id))}),l.save=s(function(t){var n=t.id;return n?e.put(u(n),a(t),p()):e.post(u(),a(t),p())}),l.examples=function(){return{success:function(e){n(function(){e(m)})}}},l}]),angular.module("c8y.core").factory("c8yStatistics",["c8yBase","$http",function(e,t){"use strict";function n(n){var r=e.url(a+"/summary"),i={params:n};return t.get(r,i)}function r(n){var r=e.url(a+"/allTenantsSummary"),i={params:e.timeOrderFilter(e.pageSizeNoTotalFilter(n))};return t.get(r,i).then(e.getResData)}var a="tenant/statistics";return{getSummary:n,list:r}}]),function(){"use strict";function e(e,t,n){function r(){return n.detail({category:"storage.limitation"})}function a(e){return n.updateOption(_.defaults({category:"storage.limitation"},e))}function i(){return n.detail({category:"storage.limitation"}).then(function(e){return!!e.data["group.name"]})}return{getStorageLimitationEmailData:r,saveStorageLimitationEmailData:a,hasStorageLimitationEnabled:i}}angular.module("c8y.core").factory("c8yStorageLimitation",["$routeParams","$q","c8ySettings",e])}(),angular.module("c8y.core").factory("c8ySystem",["$http","$q","c8yBase","$window",function(e,t,n,r){"use strict";function a(){var t=n.url(o);return e.get(t).then(n.getResData)}function i(){return t.when(r.UI_VERSION||"dev")}var o="tenant/system/options/system/version";return{getBackendVersion:a,getUIVersion:i}}]),function(){"use strict";function e(e,t,n,r,a,i,o){function u(t){var n=i.pageSizeFilter({pageSize:S}),r={params:n},a=T,o=i.url(a),s=i.cleanListCallback("tenants",u,n);return e.get(o,r).then(s)}function s(t){var n=c(t);return e.get(n)}function c(e){var t=e.id||e;return i.url(T+"/"+t)}function l(e){return c(e)+"/applications"}function f(t){t=_.cloneDeep(t);var r=!t.applications,a=r?"post":"put",o=t.allowCreateTenants;t.adminPass||(t=I(t,C)),t=r?I(t,b):I(t,A);var u=i.url(T)+(r?"":"/"+t.id),s=t,c={headers:i.contentHeaders("tenant",!0)};return e[a](u,s,c).then(function(e){return r&&o?d(e,u,c,o):n.when()})}function d(t,n,r,a){return n+="/"+t.data.id,e.put(n,{allowCreateTenants:a},r)}function p(t){var n=c(t);return e.delete(n)}function m(t,n){var r=n.id||n,a=l(t),o={application:{id:r,self:n.self}},u={headers:i.contentHeaders("applicationReference",!0)};return e.post(a,o,u)}function g(t,n){var r=n.id||n,a=l(t)+"/"+r;return e.delete(a)}function h(){return o.current().then(function(e){return y(e.tenant)})}function v(e){return y(e.parent)}function y(e){return e===E}var T="tenant/tenants",E="management",S=1e3,A=["applications","ownedApplications","adminName"],b=["allowCreateTenants"],C=["adminPass"],I=i.cleanFields;return{list:u,save:f,remove:p,detail:s,addApplication:m,removeApplication:g,isCurrentUserTopTenant:h,isParentTopTenant:v,isTopTenant:y}}e.$inject=["$http","$location","$q","$window","$interval","c8yBase","c8yUser"],angular.module("c8y.core").factory("c8yTenant",e)}(),function(){"use strict";function e(e,t,n,r,a){function i(n,a){var i=this;i.scope=n,i.filter=a||{dateFrom:moment().subtract(1,"days").startOf("day").format(e.dateFullFormat),dateTo:moment().format(e.dateFullFormat)},i.active={},i.events={},i.loadMore={},i._paths={},i.canceler=r.defer(),Object.defineProperty(i,"state",{get:function(){return t.getStatus(n.$id,"/events/*")}})}function o(e){return"c8y_LocationUpdate"===e.type}function u(e){return!s(e)}function s(e){return/gsm/gi.test(_.get(e,"c8y_Position.fixType"))}return i.prototype.abortRequests=function(){var e=this;e.canceler.resolve(),e.canceler=r.defer()},i.prototype.onPaths=function(e){this.callback=e},i.prototype._fetchAllEvents=function(){var e=this,t=_.keys(_.pickBy(e.active,_.identity)),n=_.map(t,_.bind(e._fetchEvents,e));return r.all(n).then(_.bind(e._notify,e,!0))},i.prototype._notify=function(e){var t=this;t.callback&&t.callback(L.multiPolyline(_.values(t._paths),{color:"darkblue"}),e)},i.prototype._fetchEvents=function(e){var t=this,r={source:e,type:"c8y_LocationUpdate",pageSize:1e3,withTotalPages:!0};return _.assign(r,t.filter),t._fetching=n.list(r,{timeout:t.canceler.promise}).then(function(n){return n=t._filterEvents(n),t._buildEventListCallback(e,!0)(n)}),t._fetching},i.prototype._filterEvents=function(e){var t=this,n=t.trackingOptions||{},r=_.filter(e,function(e){return o(e)&&(_.isUndefined(n.gps)&&_.isUndefined(n.gsm)||n.gps&&u(e)||n.gsm&&s(e))}),a=_.filter(_.keys(e),isNaN);return _.assign(r,_.pick(e,a)),r},i.prototype._buildLoadMore=function(e,t){var n=this;return function(){return n._fetching=t().then(n._buildEventListCallback(e,!1)).then(function(e){e.length&&n._notify(!0)}),n._fetching}},i.prototype._buildEventListCallback=function(e,t){var n=this;return function(r){var i=r.paging;return r=n.events[e]=t?r:(n.events[e]||[]).concat(r),n._paths[e]=_(r).filter(a.getLocationFragment).map(a.getLocationFragment).map(function(e){return L.latLng(e.lat,e.lng)}).value(),n.loadMore[e]=i.next&&n._buildLoadMore(e,i.next),n._fetching=!1,n._paths[e]}},i.prototype.changeInterval=function(e){var t=this;return t.filter=e,t.abortRequests(),t._fetchAllEvents()},i.prototype.refresh=function(){var e=this;return e.abortRequests(),e._fetchAllEvents()},i.prototype.activate=function(e,t){var n=this;return n.active[e]=!0,n.trackingOptions=t,n._fetchEvents(e).then(function(e){e.length&&n._notify(!0)})},i.prototype.getActiveDeviceIds=function(){var e=this;return _.keys(e.active)},i.prototype.deactivate=function(e){var t=this;delete t.active[e],delete t._paths[e],delete t.events[e],t._notify()},i.prototype.deactivateAll=function(){var e=this;_.forEach(_.keys(e.active),function(t){delete e.active[t],delete e._paths[t],delete e.events[t]}),e._notify()},i.prototype._onNotification=function(e,t){var n=this;if(n.active[t.source.id]){var r=a.getLocationFragment(t);if(r&&n._filterEvents([t]).length){var i=L.latLng(r.lat,r.lng);n._paths[t.source.id].unshift(i),n.events[t.source.id].unshift(t),n._notify(!0)}}},i.prototype.start=function(){var e=this;if(e.state)throw new Error("Tracker: Realtime is already started.");var n=e.scope.$id;t.addListener(n,"/events/*","CREATE",_.bind(e._onNotification,e)),t.start(n,"/events/*"),e.scopeDestroyer=e.scope.$on("$destroy",function(){e.state&&e.stop()})},i.prototype.stop=function(){var e=this;if(!e.state)throw new Error("Tracker: Cannot stop realtime, it has not been started.");e.scopeDestroyer(),t.stop(e.scope.$id,"/events/*")},{Tracker:i}}angular.module("c8y.core").factory("c8yTracker",["c8yBase","c8yRealtime","c8yEvents","$q","c8yGeo",e])}(),function(){"use strict";function e(e,t,n,r,a,i,o,u){function s(e,t){return e.replace(/\{tenant\}/g,t)}function c(e){return e=_.cloneDeep(e),e.id&&delete e.userName,delete e.id,delete e.self,delete e.effectiveRoles,e}function l(e){var t=e.id||e;return d().then(function(e){return e+"/"+encodeURIComponent(t)})}function f(){return t.when(i.url(ue))}function d(){return m().then(function(e){return i.url(s(oe,e.tenant))})}function p(e){var t=e.match(/\/user\/(\w+)\//);if(t.length<2)throw new Error("Cannot find tenant on user self URL");return t[1]}function m(n){var r=ue,a=_.cloneDeep(le);return n&&(se=null),se&&!_.isFunction(se.then)?t.when(se):se=se||e.get(i.url(r),a).then(function(e){return se=e.data,se.tenant=p(se.self),se},function(){return se=null,t.reject()})}function g(t){var n=i.pageSizeFilter(t),r={params:n},a=i.cleanListCallback("users",g,n);return d().then(function(t){return e.get(t,r).then(a)})}function h(t,n){var r={silentError:!!n};return l(t).then(function(t){return e.get(t,r)})}function v(){var t=i.url(ue),n=_.cloneDeep(le);return e.get(t,n)}function y(t){return l(t).then(function(t){return e.delete(t)})}function T(t){var n=c(t),r=_.cloneDeep(ce);return d().then(function(t){return e.post(t,n,r)})}function E(e){return I({id:e.id||e,enabled:!0})}function S(e){return I({id:e.id||e,enabled:!1})}function A(n,r){var a=c(n),i=_.cloneDeep(ce),o=r?f():l(n);return o.then(function(t){return e.put(t,a,i)}).then(function(e){var r=e,a=e.data,i=[];return _.isUndefined(n.owner)||n.owner===a.owner||i.push(null===n.owner?R(a):b(n,o)),_.isUndefined(n.delegatedBy)||n.delegatedBy===a.delegatedBy||i.push(null===n.delegatedBy?w(a):C(n,o)),i.length&&(r=t.all(i).then(_.partial(h,n))),r})}function b(t,n){var r={owner:t.owner},a={"Content-Type":i.mimeType("userOwnerReference")};return n.then(function(e){return e+"/owner"}).then(function(t){return e.put(t,r,{headers:a})})}function C(t,n){var r={delegatedBy:t.delegatedBy},a={"Content-Type":i.mimeType("userDelegatedByReference")};return n.then(function(e){return e+"/delegatedby"}).then(function(t){return e.put(t,r,{headers:a})})}function I(e){var t=e.id?A(e):T(e);return t.then(function(t){return D(e),t}),t}function R(t){return l(t).then(function(t){var n=t+"/owner";return e.delete(n)}).then(_.partial(h,t))}function w(t){return l(t).then(function(t){var n=t+"/delegatedby";return e.delete(n)}).then(_.partial(h,t))}function N(e){return A(e,!0).then(function(){D(e)})}function D(e){O(e).then(function(t){t&&o.updatePassword(P(e))})}function O(e){var n=e.id||e;return m().then(function(e){return t.when(e.id===n)})}function P(e){return e.password||o.getPassword()}function L(e){return o.getPassword()===e}function M(e){return(e.groups&&e.groups.references||[]).map(function(e){return e.group})}function U(e){return e.id.match(/^device_/)}function k(e,t){var n=x(e,t);return n||(n=F(e,t)),n}function x(e,t){var n=!1;return e.roles&&e.roles.references&&_.forEach(e.roles.references,function(e){e.role.id===t&&(n=!0)}),n}function F(e,t){var n=!1;return e.groups&&e.groups.references&&_.forEach(e.groups.references,function(e){_.forEach(e.group.roles.references,function(e){e.role.id===t&&(n=!0)})}),n}function $(t,n){var r=i.pageSizeFilter({moId:n}),a={params:r};return l(t).then(function(t){return e.get(t+"/devicePermissions",a)})}function G(e,t,n,r){var a=o.encodeToken(t,n,e);return o.setAuthToken(a).then(_.partial(o.saveAuthToken,r))}function j(){return o.logout()}function B(e){return _.some(e.groups.references,function(e){return"admins"===e.group.name})}function q(e){var t=o.headers();return e&&(t.Authorization="Basic "+e),_.assign(t,i.contentHeaders("user",!0))}function z(e){return _.isUndefined(e.id)?V():t.when(e).then(function(t){var n=t.twoFactorAuthenticationEnabled;return H(e).then(function(e){return e&&(n=!0),n})})}function V(){var e={category:"two-factor-authentication",key:"enabled"};return t.all([u.detailValue(e),u.getSystemOptionValue(e),K()]).then(function(e){return _.reduce(e,function(e,t){return e||t},!1)})}function H(e){return K({user:e})}function K(e){var n=e||{},r=n.user;return(r?t.when(r):m()).then(function(e){return t.all([J(e),Z(e)]).then(function(e){return Boolean(e[0]||e[1])})})}function Y(){if(!Y._calling){(Y._calling=u.getSystemOptionValue({category:"two-factor-authentication",key:"enforced"})).finally(function(){Y._calling=void 0})}return Y._calling}function W(){if(!W._calling){(W._calling=u.getSystemOptionValue({category:"two-factor-authentication",key:"enforced.group"})).finally(function(){W._calling=void 0})}return W._calling}function J(e){return Y().then(function(t){var n=[];return t&&(n=t.split(",")),_.some(n,function(t){return t===e.tenant})})}function Z(e){return W().then(function(t){return _.some(M(e),function(e){return e.name===t})})}function Q(t,n){var r=i.url("user/currentUserPhone"),a=o.encodeToken(t.name,t.password,t.tenant),u={headers:q(a),method:"PUT",url:r,data:{phone:n},silentError:!0};return e(u)}function X(n){var r=n?t.when(n):m(),a=i.url("tenant/support-user/enable");return r.then(function(){return e({method:"PUT",url:a})})}function ee(e){return e+"/roles/inventory"}function te(n){var r=n?t.when(n):m(),a=function(t){return e.get(t)};return r.then(l).then(ee).then(a)}function ne(n,r,a){var i=n?t.when(n):m(),o={managedObject:r,roles:_.map(a,function(e){return _.pick(e,"id")})},u=function(t){return e.post(t,o)};return i.then(l).then(ee).then(u)}function re(n,r,a){var i=n?t.when(n):m(),o={roles:_.map(a,function(e){return _.pick(e,"id")})},u=function(t){var n=t+"/"+r;return e.put(n,o)};return i.then(l).then(ee).then(u)}function ae(n,r){var a=n?t.when(n):m(),i=function(t){var n=t+"/"+r;return e.delete(n)};return a.then(l).then(ee).then(i)}function ie(e){var t={id:e.id};return m().then(function(e){return t.delegatedBy=e.id,A(t)})}var oe="user/{tenant}/users",ue="user/currentUser",se=null,ce={headers:i.contentHeaders("user",!0)},le={headers:i.contentHeaders("user",!0)};return r.$on("authStateChange",function(e,t){t.hasAuth||(se=null)}),{current:m,checkIfCurrent:O,list:g,detail:h,detailCurrent:v,remove:y,enable:E,disable:S,save:I,saveCurrent:N,savePhoneNumber:Q,groups:M,isDeviceUser:U,hasRole:k,getDevicePermissions:$,login:G,logout:j,isAdmin:B,isCurrentPassword:L,isTfaAvailable:V,isTfaActive:z,isTfaReadonly:H,getHeaders:q,activateSupportUser:X,delegateTo:ie,listInventoryRoles:te,assignInventoryRoles:ne,updateInventoryRoles:re,removeInventoryRoles:ae}}e.$inject=["$http","$q","$timeout","$rootScope","$routeParams","c8yBase","c8yAuth","c8ySettings"],angular.module("c8y.core").factory("c8yUser",e)}(),function(){"use strict";function e(e,t,n,r){function a(){return r.current().then(function(e){var t=e.tenant;return n.url(C+t+"/groups")})}function i(){return t.when(n.url(C+"roles"))}function o(e){var t=e.id||e;return r.current().then(function(e){var r=e.tenant;return n.url(C+r+"/groups/"+t)})}function u(e,t){return o(e).then(function(e){return e+"/users"+(t?"/"+encodeURIComponent(t.id||t):"")})}function s(e){return o(e).then(function(e){return e+"/roles"})}function c(e,t){var n=t.id||t;return s(e).then(function(e){return e+"/"+n})}function l(t){var r=n.pageSizeFilter(t),i={params:r},o=n.cleanListCallback("groups",l,r);return a().then(function(t){return e.get(t,i).then(o)})}function f(t){return o(t).then(function(t){return e.get(t)})}function d(t){return o(t).then(function(t){return e.delete(t)})}function p(t){var r={headers:n.contentHeaders("group")};return o(t).then(function(n){return e.put(n,t,r).then(function(){return t})})}function m(t){var r={headers:n.contentHeaders("group")};return a().then(function(n){return e.post(n,t,r).then(function(e){return f(e.headers("location").match(/\d+$/)[0]).then(function(e){return e.data})})})}function g(e){return e.id?p(e):m(e)}function h(t){var r=n.pageSizeFilter(t),a={params:r,cache:!0},o=n.cleanListCallback("roles",h,r);return i().then(function(t){return e.get(t,a).then(o)})}function v(e){return h().then(function(t){var n;return t.forEach(function(t){if(t.id===e)return n=t,!1}),n})}function y(t,n){var r={user:_.pick(n,["id","self"])};return u(t).then(function(t){return e.post(t,r)})}function T(t,n){return u(t,n).then(function(t){return e.delete(t)})}function E(e,n){var r=_.get(e,"groups.references",[]),a=r.map(function(e){return e.group.id}),i=[];return n.forEach(function(t){-1===a.indexOf(t)&&i.push(y(t,e))}),a.forEach(function(t){-1===n.indexOf(t)&&i.push(T(t,e))}),t.all(i)}function S(t,r){var a={headers:n.contentHeaders("roleReference")};return s(t).then(function(t){return e.post(t,{role:r},a)})}function A(t,n){return c(t,n).then(function(t){return e.delete(t)})}function b(e,n){var r=e.roles.references.map(function(e){return e.role.id}),a=[];return n.forEach(function(t){-1===r.indexOf(t)&&a.push(v(t).then(function(t){return S(e,t)}))}),r.forEach(function(t){-1===n.indexOf(t)&&a.push(A(e,t))}),t.all(a)}var C="user/";return{list:l,detail:f,remove:d,create:m,update:p,save:g,listRoles:h,updateGroups:E,updateRoles:b}}e.$inject=["$http","$q","c8yBase","c8yUser"],angular.module("c8y.core").factory("c8yUserGroup",e)}(),function(){"use strict";function e(e,t,n){function r(e){return n.current().then(_.partial(a,e))}function a(e,t){var n=i(e,t);return o(t,n).then(_.partial(u,n))}function i(e,t){return e+t.userName.replace(/\./g,"__")}function o(n,r){if(f(n))return t.list({fragmentType:r}).then(function(e){return e.length?e[0]:{type:"c8y_UserPreference"}});var a=d(),i={};return i[r]=a[r],e.when(i)}function u(e,t){return t[e]}function s(e,t){return n.current().then(_.partial(c,e,t))}function c(e,t,n){var r=i(e,n);return o(n,r).then(_.partial(l,r,t,n))}function l(e,n,r,a){if(f(r))return a[e]=n,t.save(a);var i=d();i[e]=n,p(i)}function f(e){return n.hasRole(e,"ROLE_INVENTORY_READ")&&n.hasRole(e,"ROLE_INVENTORY_ADMIN")}function d(){var e=window.localStorage.getItem(m);try{e=JSON.parse(e)}catch(t){e={}}return e||{}}function p(e){window.localStorage.setItem(m,JSON.stringify(e))}var m="userPreferences";return{get:r,set:s}}angular.module("c8y.core").factory("c8yUserPreferences",["$q","c8yInventory","c8yUser",e])}(),function(){"use strict";function e(e,t){this.dateToString=function(e){return e&&moment(e).format(t.dateFormat)},this.stringToDate=function(e){return e&&moment(e).toDate()},this.setLocal=function(t,n){e.localStorage.setItem(t,JSON.stringify(n))},this.getLocal=function(t){try{return JSON.parse(e.localStorage.getItem(t))}catch(e){if(e instanceof SyntaxError)return;throw e}}}angular.module("c8y.core").service("c8yUtil",["$window","c8yBase",e])}(),angular.module("c8y.core").factory("c8yWorkers",["c8yBase","$timeout",function(e,t){"use strict";var n={};return n.create=function(n){var r,a=new Worker(e.url(n)),i=!0;return r={push:function(e){return a.postMessage(e),r},terminateOnMessage:function(){return i=!1,r},message:function(e){return a.onmessage=function(n){t(function(){e(n.data),i||a.terminate()})},r},error:function(e){return a.onerror=function(n){t(function(){e(n),i||a.terminate()})},r},terminate:function(){a.terminate()}}},n}]),function(){"use strict";angular.module("c8y.core").constant("latestMixinFactory",function(e){var t={};return t.latest=function(t){if(!_.isFunction(t))throw new TypeError("Argument needs to be a function");var n=-1;return function(){var r=++n,a=t.apply(this,arguments);if(!_.isFunction(a.then))throw new TypeError("Function must return a promise");return a=a.then(function(t){return r!==n?e.reject("Promise is cancelled by a more recent one."):t},function(t){return r!==n?e.reject("Promise is cancelled by a more recent one."):e.reject(t)})}},t})}(),function(){"use strict";var e={};e.getKeys=function(e){var t=this.reservedKeys||[],n=function(e){return-1===t.indexOf(e)};return _.keys(e).filter(n)},e.getStandardKeys=function(e){var t=this.standardKeys||{};return _.pickBy(t,function(t,n){return _.has(e,n)})},e.getNonStandardKeys=function(e){return _.difference(this.getKeys(e),_.keys(this.getStandardKeys(e)))},angular.module("c8y.core").constant("KeysMixin",e)}(),function(){"use strict";angular.module("c8y.sdk",["c8y.core"]).constant("info",{})}(),function(){function e(e){function t(t,n){n.bind("click",function(){e.login(t.tenant(),t.user(),t.password(),t.rememberMe()).then(t.onSuccess).catch(t.onFailure)})}return{restrict:"A",link:t,scope:{tenant:"&",user:"&",password:"&",rememberMe:"&",onSuccess:"&",onFailure:"&"}}}angular.module("c8y.sdk").directive("c8yLogin",["c8yCumulocity",e])}(),function(){function e(e){function t(t,n){n.bind("click",function(n){e.logout(),t.ngClick(),n.stopPropagation()})}return{priority:1,restrict:"A",link:t,scope:{ngClick:"&"}}}angular.module("c8y.sdk").directive("c8yLogout",["c8yCumulocity",e])}(),function(){function e(e,t,n){function r(r){return function(a,i,o){function u(){a.refresh=s}function s(){n.c8y&&n.c8y.user&&c().then(function(e){p.__c8y_serviceResult=e})}function c(){var t=a.filter||{};return e.get("c8y"+l(f)).list(t)}function l(e){return e[0].toUpperCase()+e.slice(1)}var f,d,p,m=r;!function(){var e=/^\s*([^\s]+)\s*in\s*([^\s]+)\s*/,n=e.exec(o.c8yRepeat),r=n[1];f=n[2],m.removeAttr("c8y-repeat"),m.removeAttr("data-c8y-repeat"),m.attr("ng-repeat",r+" in __c8y_serviceResult track by "+r+".id"),d=t(m),$(i).replaceWith(m)}(),function(){p=a.$parent,d(p),u(),n.$on("c8y.api.login",function(){s()}),a.$watch("filter",s,!0)}()}}return{restrict:"A",compile:function(e){return r($(e).clone())},transclude:!1,scope:{filter:"=?",refresh:"=?"}}}angular.module("c8y.sdk").directive("c8yRepeat",["$injector","$compile","$rootScope",e])}(),function(){"use strict";function e(e,t,n,r,i){!function(){var e=t.localStorage.getItem(a)||t.sessionStorage.getItem(a);r.token=e}(),function(){if(!r.token||r.preventGetUser)return n.reject("No token");i.current().then(function(t){(e.c8y=e.c8y||{}).user=t,e.$emit("c8y.api.login")})}()}function t(e){function t(){return e.baseUrl}function n(){return e.appKey}function r(){return e.tenant}return{getBaseUrl:t,getAppKey:n,getTenant:r}}function n(e){function n(t){e.baseUrl=t}function a(t){e.appKey=t}function i(t){e.tenant=t}var o={setBaseUrl:n,setAppKey:a,setTenant:i,$get:["info","$window","$rootScope","c8yUser",r]};return _.assign(o,t(e)),o}function r(e,n,r,a){function i(e,t,n,i){return e=e||s.getTenant(),a.login(e,t,n,i).then(o).then(function(){r.$emit("c8y.api.login")})}function o(e){(r.c8y=r.c8y||{}).user=e}function u(){o(null),a.logout(),r.$emit("c8y.api.logout")}var s=t(e),c={login:i,logout:u};return _.assign(c,s),c}var a="_tcy8";angular.module("c8y.sdk").provider("c8yCumulocity",["info",n]).run(["$rootScope","$window","$q","info","c8yUser",e])}();
//# sourceMappingURL=build/main.js.map